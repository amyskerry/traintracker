YUI.add("gallery-selection-dialog-view",function(e){e.namespace("Views")[this.name]=e.Base.create("gallery-selection-dialog-view",e.Views["album-selection-dialog-view"],[],{loadState:function(){var t=this;return e.batch(this.appContext.getModel("person-galleries-models",this.appContext.auth.user.nsid),this.appContext.getModel("photo-contexts-models",this.get("photoID"))).then(function(e){t.set("albumList",e[0].getValue("galleries").toJSON()),t.set("albumListForPhoto",e[1].registry.getContextsOfType(t.get("photoID"),"gallery-models")),t.set("photoContexts",e[1])},function(e){throw t.onError({message:"There was a problem loading your galleries",err:e,rejuvinate:!1}),e})},addPhoto:function(e){var t=this;return this.appContext.getModelRegistry("gallery-models").then(function(n){return n.remote.addPhoto({photoID:t.get("photoID"),galleryCompoundID:e},t.appContext).then(function(e){return t.appContext.getModel("photo-contexts-models",t.get("photoID")).then(function(t){t.getValue("contexts").appendToList(e)}),e},function(e){throw t.onError({message:"There was a problem adding this photo to the gallery",err:e}),e}).then(null,function(e){throw console.log("err",e.message,e.stack),e})})},removePhoto:function(e){var t=this;return this.appContext.getModelRegistry("gallery-models").then(function(n){return n.remote.removePhoto({photoID:t.get("photoID"),galleryCompoundID:e},t.appContext).then(function(n){return t.appContext.getModel("photo-contexts-models",t.get("photoID")).then(function(t){t.getValue("contexts").removeFromList(e.split("-")[1])}),n},function(e){throw t.onError({message:"There was a problem removing this photo from the gallery",err:e}),e})})},createNewAndAddPhoto:function(e,t){var n=this;return this.appContext.getModelRegistry("gallery-models").then(function(r){return r.remote.create({photoID:n.get("photoID"),title:e,description:t},n.appContext).then(function(e){return n.appContext.getModel("photo-contexts-models",n.get("photoID")).then(function(t){t.getValue("contexts").appendToList(e)}),e},function(e){throw n.onError({message:"There was a problem creating your new gallery",err:e}),e})})},onError:function(t){var n=this.get("container"),r,i=typeof t.rejuvinate=="undefined"?!0:t.rejuvinate,s=e.Views.dialog.getNewInstance("dialog-alert",{content:"Error! "+t.message,attrs:{level:"warning"},parent:this,visibleShim:!0});s.show(),i&&s.on("dismiss",function(t){r=e.Views.dialog.getNewInstance("dialog-modal",{content:n,appContext:this.appContext}),r.show()}),this.appContext.error(t.err.message,t.err.stack)}})},"@VERSION@",{requires:["flickr-view","album-selection-css","album-selection-dialog-view"],optional:["set-models"]});
YUI.add("group-selection-dialog-view",function(e){e.namespace("Views")[this.name]=e.Base.create("group-selection-dialog-view",e.Views["album-selection-dialog-view"],[],{loadState:function(){var t=this,n=[],r;return this.set("page",1),this.set("perPage",400),this.appContext.getModel("person-groups-models",this.appContext.auth.user.nsid).then(function(e){t.set("personGroupsModel",e)}).then(function(){return e.batch(t.get("personGroupsModel").getValue("groups").getPage({page:t.get("page"),perPage:t.get("perPage")}),t.appContext.getModel("photo-contexts-models",t.get("photoID")),t.appContext.getModel("photo-models",t.get("photoID")),t.appContext.getModel("photo-group-invitations-models",t.get("photoID"))).then(function(e){var i=e[2],s=e[0],o;for(o=0;o<s.length;o++)s[o]=s[o].toJSON();i.getValue("isOwner")?n=s:s.forEach(function(e){e.isAdmin&&n.push(e)}),r=e[1].registry.getContextsOfType(t.get("photoID"),"groups-pool-models"),r=r.concat(e[3].getValue("groups").getList()),t.set("albumList",n),t.set("albumListForPhoto",r),t.set("photoContexts",e[1]),t.recursivelyLoadMore()})}).then(null,function(e){throw t.onError({message:"There was a problem loading the groups you can add photos to.",err:e,rejuvinate:!1}),e})},recursivelyLoadMore:function(){var e=this,t,n=e.get("personGroupsModel").getValue("groups").hasMaxBoundary();n||(e.set("page",e.get("page")+1),this.get("personGroupsModel").getValue("groups").getPage({page:e.get("page"),perPage:e.get("perPage")}).then(function(n){for(t=0;t<n.length;t++)n[t]=n[t].toJSON();e.appendAlbums(n),e.recursivelyLoadMore()}).then(null,function(t){throw e.onError({message:"There was a problem loading the groups you can add photos to.",err:t,rejuvinate:!1}),t}))},addPhoto:function(t){var n=this;return e.batch(this.appContext.getModelRegistry("groups-pool-models"),this.appContext.getModel("photo-models",this.get("photoID"))).then(function(e){var r=e[0],i=e[1];return i.getValue("isOwner")?r.remote.addPhoto({photoID:n.get("photoID"),groupID:t},n.appContext).then(function(e){return n.appContext.getModel("photo-contexts-models",n.get("photoID")).then(function(t){t.getValue("contexts").appendToList(e)}),e},function(e){throw n.onError({message:"There was a problem adding this photo to the group",err:e}),e}).then(null,function(e){throw n.onError({message:e.message,err:e}),e}):r.remote.invitePhoto({photoID:n.get("photoID"),groupID:t},n.appContext).then(function(e){return e},function(e){throw n.onError({message:"There was a problem inviting this photo to the group",err:e}),e}).then(null,function(e){throw n.onError({message:e.message,err:e}),e})})},removePhoto:function(t){var n=this;return e.batch(this.appContext.getModelRegistry("groups-pool-models"),n.appContext.getModel("photo-contexts-models",n.get("photoID"))).then(function(e){var r=e[0],i=e[1],s=[],o=i.getValue("contexts").getList();return o.forEach(function(e){s.push(e.getValue("id"))}),s.indexOf(t)>=0?r.remote.removePhoto({photoID:n.get("photoID"),groupID:t},n.appContext).then(function(e){return i.getValue("contexts").removeFromList(t),e},function(e){throw n.onError({message:"There was a problem removing this photo from the group",err:e}),e}):r.remote.cancelPhotoInvitation({photoID:n.get("photoID"),groupID:t},n.appContext).then(function(e){return e},function(e){throw n.onError({message:"There was a problem cancelling this photo's invitation to the group",err:e}),e})}).then(null,function(e){throw n.appContext.error(e.message,e.stack),e})},onError:function(t){var n=this.get("container"),r,i=typeof t.rejuvinate=="undefined"?!0:t.rejuvinate,s,o,u;o=new e.Views["confirmation-dialog-view"]({title:"Flag",icon:"ui-icon-big-error",heading:"Error",content:t.message,confirmButtonLabel:"Got it",cancelButtonLabel:"",showCancelButton:!1}),o.render(),o.activate(),u=o.get("container"),s=e.Views.dialog.getNewInstance("dialog-modal",{content:o.get("container"),appContext:this.appContext}),s.show(),o.registerEventHandler(u.one(".ui-dialog-button-confirm").on("click",function(){s.hide(),i&&(r=e.Views.dialog.getNewInstance("dialog-modal",{content:n,appContext:this.appContext}),r.show())},this)),this.appContext.error(t.err.message,t.err.stack)}})},"@VERSION@",{requires:["flickr-view","album-selection-css","album-selection-dialog-view"],optional:["set-models"]});
YUI.add("hermes-templates-more-button",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{},'<a href="#" title="More Actions" class="button">\n	<span class="more-button hide-text">&hellip;</span>\n</a>\n'}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/more-button"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-more-menu",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.enableAddToSet,{hash:{},inverse:u.program(4,h,t),fn:u.program(2,c,t),data:t});if(i||i===0)r+=i;return r+='\n			<i class="ui-icon-tiny-add-to-gallery-or-set"></i> Add to set\n		</a></li>\n	',r}function c(e,t){return'\n			<li><a href="#" class="add-to-set">\n		'}function h(e,t){return'\n			<li><a href="#" class="unavailable-feature">\n		'}function p(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.enableAddToGroup,{hash:{},inverse:u.program(4,h,t),fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;r+='\n			<i class="ui-icon-tiny-add-to-group"></i> \n				',i=n["if"].call(e,e.viewerIsOwner,{hash:{},inverse:u.program(11,m,t),fn:u.program(9,v,t),data:t});if(i||i===0)r+=i;return r+="\n		</a></li>\n	",r}function d(e,t){return'\n			<li><a href="#" class="add-to-group">\n		'}function v(e,t){return"\n					Add to group\n				"}function m(e,t){return"\n					Invite to group\n				"}function g(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.enableAddToGallery,{hash:{},inverse:u.program(4,h,t),fn:u.program(14,y,t),data:t});if(i||i===0)r+=i;return r+='\n			<i class="ui-icon-tiny-add-to-gallery-or-set"></i> Add to gallery\n		</a></li>\n	',r}function y(e,t){return'\n			<li><a href="#" class="add-to-gallery">\n		'}function b(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.enableAddLocation,{hash:{},inverse:u.program(4,h,t),fn:u.program(17,w,t),data:t});if(i||i===0)r+=i;return r+='\n			<i class="ui-icon-tiny-add-location"></i> Add location\n		</a></li>\n	',r}function w(e,t){return'\n			<li><a href="#" class="add-location">\n		'}function E(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.enableAddPeople,{hash:{},inverse:u.program(4,h,t),fn:u.program(20,S,t),data:t});if(i||i===0)r+=i;return r+='\n			<i class="ui-icon-tiny-add-people"></i> Add people\n		</a></li>\n	',r}function S(e,t){return'\n			<li><a href="#" class="add-people">\n		'}function x(e,t){var r="",i;return r+='\n		<li><a href="',(i=n.photoURL)?i=i.call(e,{hash:{},data:t}):(i=e.photoURL,i=typeof i===a?i.apply(e):i),r+=f(i)+'edit-details/" class="server-only-link edit-title-tags-dates">\n			<i class="ui-icon-tiny-edit"></i> Edit title, tags, and dates\n		</a></li>\n	',r}function T(e,t){return'\n		<li><a href="#" class="rotate-photo">\n			<i class="ui-icon-tiny-rotate"></i> Rotate\n		</a></li>\n	'}function N(e,t){return'\n		<li><a href="#" class="replace-photo">\n			<i class="ui-icon-tiny-replace"></i> Replace\n		</a></li>\n	'}function C(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e.enableEditInAviary,{hash:{},inverse:u.program(4,h,t),fn:u.program(29,k,t),data:t});if(i||i===0)r+=i;return r+='\n			<i class="ui-icon-tiny-edit-in-aviary"></i> Edit in Aviary\n		</a></li>\n	',r}function k(e,t){return'\n			<li><a href="#" class="edit-aviary">\n		'}function L(e,t){return'\n		<li><a href="#" class="comment-control-photo">\n			<i class="ui-icon-tiny-commenting-on"></i> Commenting\n		</a></li>\n	'}function A(e,t){return'\n		<li><a href="#" class="flag-photo">\n			<i class="ui-icon-tiny-flag"></i> Flag photo\n		</a></li>\n	'}function O(e,t){return'\n		<li><a href="/abuse/" class="report-photo">\n			<i class="ui-icon-tiny-report"></i> Report abuse\n		</a></li>\n	'}function M(e,t){return'\n		<li><a href="#" class="delete-photo">\n			<i class="ui-icon-tiny-delete"></i> Delete photo\n		</a></li>\n	'}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;s+="<ul>\n	\n	\n	\n	",o=n["if"].call(t,t.showAddToSetLink,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showAddToGroupLink,{hash:{},inverse:u.noop,fn:u.program(6,p,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showAddToGalleryLink,{hash:{},inverse:u.noop,fn:u.program(13,g,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showAddLocationLink,{hash:{},inverse:u.noop,fn:u.program(16,b,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showPeopleTagLink,{hash:{},inverse:u.noop,fn:u.program(19,E,i),data:i});if(o||o===0)s+=o;s+='\n	\n	\n	\n	<li><a href="',(o=n.photoURL)?o=o.call(t,{hash:{},data:i}):(o=t.photoURL,o=typeof o===a?o.apply(t):o),s+=f(o)+'sizes/" class="server-only-link view-all-sizes">\n		<i class="ui-icon-tiny-all-sizes"></i> Download / All sizes\n	</a></li>\n	\n	<li><a href="',(o=n.photoURL)?o=o.call(t,{hash:{},data:i}):(o=t.photoURL,o=typeof o===a?o.apply(t):o),s+=f(o)+'meta/" class="server-only-link view-exif">\n		<i class="ui-icon-tiny-exif"></i> View Exif info\n	</a></li>\n	\n	'+"\n	\n	",o=n["if"].call(t,t.showEditMetaLink,{hash:{},inverse:u.noop,fn:u.program(22,x,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showRotateLink,{hash:{},inverse:u.noop,fn:u.program(24,T,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showReplaceLink,{hash:{},inverse:u.noop,fn:u.program(26,N,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showEditInAviaryLink,{hash:{},inverse:u.noop,fn:u.program(28,C,i),data:i});if(o||o===0)s+=o;s+="\n	\n	",o=n["if"].call(t,t.showCommentControl,{hash:{},inverse:u.noop,fn:u.program(31,L,i),data:i});if(o||o===0)s+=o;s+="\n	\n	\n	\n	",o=n["if"].call(t,t.showFlagLink,{hash:{},inverse:u.noop,fn:u.program(33,A,i),data:i});if(o||o===0)s+=o;s+="\n\n	",o=n["if"].call(t,t.showReportAbuseLink,{hash:{},inverse:u.noop,fn:u.program(35,O,i),data:i});if(o||o===0)s+=o;s+="\n	\n	\n	\n	",o=n["if"].call(t,t.showDeleteLink,{hash:{},inverse:u.noop,fn:u.program(37,M,i),data:i});if(o||o===0)s+=o;return s+="\n\n</ul>\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/more-menu"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-temporary-organizr-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{},"Hey! We\u2019re hard at work redesigning everything for our brand new photo page. But while we\u2019re working on that we wanted you to be able to edit your photos. So if you don\u2019t mind, below you\u2019ll find a link that\u2019ll open this photo in the Organizr in a new tab.<br>\n<br>"}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/temporary-organizr-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-flag-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function h(e,t){return"\n	within\n"}function p(e,t){return"\n	outside\n"}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='This photo is marked as <a href="http://www.flickr.com/help/filters/#258">',a={hash:{},data:i},s+=l((o=n.configVal,o?o.call(t,"safetyLevel",t.safetyLevel,a):f.call(t,"configVal","safetyLevel",t.safetyLevel,a)))+"</a> \nand falls \n",u=n["if"].call(t,t.fallsWithinSettings,{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;return s+='\nyour <a href="http://www.flickr.com/account/prefs/safesearch/">SafeSearch settings</a>.\nFor more information please read <a href="http://www.flickr.com/help/photos/?search=flag#145">this FAQ</a>.',s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/flag-photo-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-delete-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{},"Are you sure you want to delete this photo?<br>\n<strong>This cannot be undone.</strong>"}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/delete-photo-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-replace-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){return'\n<div class="ui-dialog-wrapper c-dialog-cta-photoreplace">\n	<div class="ui-dialog-description js-description">\n		There was a problem uploading this photo, please close and retry.\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button c-button-cancel" data-action="dismiss"><span>Close</span></button>\n	</div>\n</div>\n'}function c(e,t){var r="",i;r+='\n<div class="ui-dialog-wrapper c-dialog-cta-photoreplace">\n	<div class="ui-dialog-description js-description">\n		',i=n["if"].call(e,e.fileName,{hash:{},inverse:f.program(9,v,t),fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;r+='\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		',i=n["if"].call(e,e.fileName,{hash:{},inverse:f.program(14,y,t),fn:f.program(11,m,t),data:t});if(i||i===0)r+=i;return r+='\n		<button class="ui-button c-button-cancel" data-action="dismiss"><span>Cancel</span></button>\n	</div>\n</div>\n',r}function h(e,t){var r="",i;r+="\n			",i=n["if"].call(e,e.uploading,{hash:{},inverse:f.program(7,d,t),fn:f.program(5,p,t),data:t});if(i||i===0)r+=i;return r+="\n		",r}function p(e,t){var r="",i;return r+="\n				Uploading <em>",(i=n.fileName)?i=i.call(e,{hash:{},data:t}):(i=e.fileName,i=typeof i===u?i.apply(e):i),r+=a(i)+'</em>...\n				<progress min="0" max="100" value="0"></progress>\n			',r}function d(e,t){var r="",i;return r+="\n				Replace this photo with <em>",(i=n.fileName)?i=i.call(e,{hash:{},data:t}):(i=e.fileName,i=typeof i===u?i.apply(e):i),r+=a(i)+"</em>?\n			",r}function v(e,t){return"\n			Choose a file to replace this photo with.\n		"}function m(e,t){var r="",i;r+="\n			",i=n.unless.call(e,e.uploading,{hash:{},inverse:f.noop,fn:f.program(12,g,t),data:t});if(i||i===0)r+=i;return r+="\n		",r}function g(e,t){return'\n				<button class="ui-button ui-button-cta c-button-replace" data-action="submit"><span>Replace</span></button>\n			'}function y(e,t){return'\n			<input type="file" name="file" accept="image/*">\n			<button class="ui-button ui-button-cta c-button-changefile" data-action="change"><span>Choose file</span></button>\n		'}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;o=n["if"].call(t,t.error,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/replace-photo-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-rotate-photo-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return'\n<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n	<div class="ui-dialog-description js-description">\n		There was a problem rotating this photo, please close and retry.\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button c-button-cancel" data-action="dismiss"><span>Close</span></button>\n	</div>\n</div>\n'}function h(e,t){var r="",i,s,o;r+='\n<div class="ui-dialog-wrapper c-dialog-cta-photorotate">\n	<div class="ui-dialog-description js-description">\n		Pick a new rotation for this photo.\n\n		<ul class="c-rotations ',o={hash:{},inverse:u.noop,fn:u.program(4,p,t),data:t},s=(i=n.ifCond,i?i.call(e,(i=e.preview,i==null||i===!1?i:i.width),"<",(i=e.preview,i==null||i===!1?i:i.height),o):a.call(e,"ifCond",(i=e.preview,i==null||i===!1?i:i.width),"<",(i=e.preview,i==null||i===!1?i:i.height),o));if(s||s===0)r+=s;return r+='">\n			<li><img class="ui-util-rotate-90" src="'+l((i=(i=e.preview,i==null||i===!1?i:i.url),typeof i===f?i.apply(e):i))+'" data-action="select" data-rotation="90"></li>\n			<li><img class="ui-util-rotate-180" src="'+l((i=(i=e.preview,i==null||i===!1?i:i.url),typeof i===f?i.apply(e):i))+'" data-action="select" data-rotation="180"></li>\n			<li><img class="ui-util-rotate-270" src="'+l((i=(i=e.preview,i==null||i===!1?i:i.url),typeof i===f?i.apply(e):i))+'" data-action="select" data-rotation="270"></li>\n		</ul>\n\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button ui-button-cta c-button-rotate" data-action="submit"><span>Rotate the photo</span></button>\n		<button class="ui-button c-button-cancel" data-action="dismiss"><span>Cancel</span></button>\n	</div>\n</div>\n',r}function p(e,t){return"c-rotations-portrait"}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u=this,a=n.helperMissing,f="function",l=this.escapeExpression;o=n["if"].call(t,t.error,{hash:{},inverse:u.program(3,h,i),fn:u.program(1,c,i),data:i});if(o||o===0)s+=o;return s+="\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/rotate-photo-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-photo-comment-permission-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return"checked"}function h(e,t){return'\n	<label for="dialog-photo-commenting-contacts" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-contacts" value="2" checked>\n		Contacts\n	</label>\n	'}function p(e,t){return'\n	<label for="dialog-photo-commenting-ff" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-ff" value="1" checked>\n		Friends &amp; Family\n	</label>\n	'}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f=this,l=n.helperMissing;s+='Allow people to comment on this photo?\n\n<form class="pure-form"><fieldset>\n	\n	<label for="dialog-photo-commenting-public" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-public" value="3" ',a={hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i},u=(o=n.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",3,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",3,a));if(u||u===0)s+=u;s+=">\n		Yes\n	</label>\n	\n	",a={hash:{},inverse:f.noop,fn:f.program(3,h,i),data:i},u=(o=n.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",2,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",2,a));if(u||u===0)s+=u;s+="\n	\n	",a={hash:{},inverse:f.noop,fn:f.program(5,p,i),data:i},u=(o=n.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",1,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",1,a));if(u||u===0)s+=u;s+='\n	\n	<label for="dialog-photo-commenting-private" class="pure-radio">\n		<input type="radio" name="photo-commenting" id="dialog-photo-commenting-private" value="0" ',a={hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i},u=(o=n.ifCond,o?o.call(t,t.currentCommentPermissionValue,"===",0,a):l.call(t,"ifCond",t.currentCommentPermissionValue,"===",0,a));if(u||u===0)s+=u;return s+=">\n		No\n	</label>\n	\n</fieldset></form>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/photo-comment-permission-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-reboot-unimplemented-feature-dialog-content",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function a(e,t){return"\n	<br>\n	While we don't yet support what you&rsquo;re trying to do, you are free to opt out of the new experience and then opt back in if you wish.\n"}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u=this;s+="This is a beta version of the photo page redesign and is missing some features. We are working hard on adding new functionality frequently. We will provide most of the functionality you expect on Flickr soon.<br>\n",o=n["if"].call(t,t["opt-out-enabled"],{hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="\n<br>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/reboot-unimplemented-feature-dialog-content"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("more-menu-view",function(e){e.namespace("Views")[this.name]=e.Base.create("more-menu-view",e.FlickrView,[],{initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.realFullscreen=!!e.realFullscreen,this},loadState:function(){var t=this,n=[];return n.push(t.appContext.getModel("person-relationship-models",t.nsid).then(function(e){t.set("ownerRelationship",e)})),n.push(t.appContext.getModel("photo-models",t.photoId).then(function(e){t.set("photo",e)})),n.push(t.appContext.getModel("photo-privacy-models",t.photoId).then(function(e){t.set("photoPrivacy",e)})),this.appContext.auth.signedIn&&n.push(t.appContext.getModel("person-groups-models",t.appContext.auth.user.nsid).then(function(e){return t.set("personGroups",e),t.get("personGroups").getValue("groups").getPage({page:1,perPage:400})})),e.batch.apply(null,n)},buildContainer:function(){var e;return e=this.templates("more-button")(),this.setContainerHTML(e),this},onError:function(t){var n=e.Views.dialog.getInstance("dialog-alert",{content:"Error! "+t,attrs:{level:"warning"},parent:this});n.show()},setupDropdown:function(){var t=this.get("container"),n=this.get("photo"),r=this.get("photoPrivacy"),i,s=this.get("ownerRelationship"),o=s.getValue("isMe"),u=[],a=!1,f=!1,l=t,c,h=o,p=!1,d=!1,v=!1,m=!1,g=!1;this.appContext.auth.signedIn&&(u=this.get("personGroups").getValue("groups").toJSON()),n.getValue("safetyLevel")===0&&r.getValue("isPublic")&&!o&&this.appContext.auth.signedIn&&(p=!0),u.forEach(function(e){if(e.isAdmin){a=!0;return}});if(u.length>0&&o||a)f=!0;this.appContext.flipper.isFlipped("add-to-group")&&(d=!0),this.appContext.flipper.isFlipped("add-location")&&o&&(v=!0),this.appContext.flipper.isFlipped("add-people")&&o&&(m=!0),this.appContext.flipper.isFlipped("aviary")&&o&&(g=!0),i=e.URLHelper.getPhotoPage({photoId:n.getValue("id"),pathAlias:n.getValue("owner").getValue("pathAlias")}),c=this.templates("more-menu")({photoURL:i,viewerIsOwner:o,isAtLeastOneGroupAdmin:a,showFlagLink:!o&&this.appContext.auth.signedIn,showDeleteLink:o,showEditMetaLink:o,showCommentControl:o,showReportAbuseLink:!o&&this.appContext.auth.signedIn,showRotateLink:o,showReplaceLink:o,showAddToSetLink:o,enableAddToSet:h,showAddToGroupLink:f,enableAddToGroup:d,showAddToGalleryLink:!o&&this.appContext.auth.signedIn,enableAddToGallery:p,showAddLocationLink:o,enableAddLocation:v,showPeopleTagLink:o,enableAddPeople:m,showEditInAviaryLink:o,enableEditInAviary:g}),this.moreMenu=e.Views.dialog.getNewInstance("dialog-tooltip",{content:c,anchorTo:l,parent:this,positioning:!1,rootEl:t}),this.moreMenu.render()},handleMenuButtonClick:function(t){t.halt(),e.rapidTracker.beacon(this.name,"moreMenuClick"),this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()?(e.fire("flickr:photo-sidebar-fullscreen-expand"),setTimeout(function(){e.fire("flickr:photo-sidebar-action-more-expand")},500)):this.moreMenu.toggle()},handleFlagPhotoClick:function(t){t.preventDefault();var n=this.get("photo").getValue("safetyLevel"),r=this.get("personPreferences").getValue("safeSearch"),i,s,o;this.moreMenu.hide(),i=this.templates("flag-photo-dialog-content")({safetyLevel:n,fallsWithinSettings:n<=r}),s=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Flag",icon:"ui-icon-big-flag",heading:"Flag this photo for review by Flickr staff.",content:i,confirmButtonLabel:"Flag Photo"}),s.render(),s.activate(),o=s.get("container"),s.registerEventHandler(o.one(".ui-dialog-button-confirm").on("click",this.handleFlagPhotoConfirmClick,this)),this.flagDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:s.get("container"),appContext:this.appContext}),this.flagDialog.show(),e.rapidTracker.beacon(this.name,"flagPhotoClick")},handleFlagPhotoConfirmClick:function(t){var n=this;e.rapidTracker.beacon(this.name,"flagPhotoConfirmationClick"),n.flagDialog.close(),n.flagDialog.destroy(),this.appContext.flickrAPI.callMethod("flickr.moderation.flagPhoto",{photo_id:this.photoId,offensive:1}).then(function(e){n.get("container").one(".flag-photo").replace("This photo has been flagged")},function(e){n.onError("There was a problem flagging this photo")})},handleAddToGroupClick:function(t){t.preventDefault();var n,r,i=this.get("ownerRelationship").getValue("isMe"),s=i?"Add":"Invite";this.moreMenu.hide(),n=new e.Views["group-selection-dialog-view"]({type:"group",titleSelect:s+" this photo to a group",loadingText:"Loading groups...",noneText:"No groups",placeholderSearch:"search groups",buttonTextComplete:"",canCreateNew:!1,photoID:this.photoId,viewerIsOwner:this.get("ownerRelationship").getValue("isMe")}),n.appContext=this.appContext,n.buildContainer(),r=n.get("container"),this.addToGroupDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),this.addToGroupDialog.show(),n.activate(),e.rapidTracker.beacon(this.name,"addToGroupClick")},handleAddToGalleryClick:function(t){t.preventDefault();var n,r;this.moreMenu.hide(),n=new e.Views["gallery-selection-dialog-view"]({type:"galleries",titleSelect:"Add this photo to a gallery",titleCreate:"Make a new gallery for this photo",loadingText:"Loading galleries...",noneText:"No galleries",placeholderSearch:"search galleries",placeholderTitle:"gallery title (required)",placeholderDescription:"gallery description",buttonTextSwitchCreate:"Create a new gallery",buttonTextCreate:"Create gallery",buttonTextComplete:"Done",buttonTextCancel:"Cancel",canCreateNew:!0,photoID:this.photoId}),n.appContext=this.appContext,n.buildContainer(),r=n.get("container"),this.addToGalleryDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),this.addToGalleryDialog.show(),n.activate(),e.rapidTracker.beacon(this.name,"addToGalleriesClick")},handleAddToSetClick:function(t){t.preventDefault();var n,r;this.moreMenu.hide(),n=new e.Views["set-selection-dialog-view"]({type:"sets",titleSelect:"Add this photo to a set",titleCreate:"Make a new set for this photo"
,loadingText:"Loading sets...",noneText:"No sets",placeholderSearch:"search sets",placeholderTitle:"set title (required)",placeholderDescription:"set description",buttonTextSwitchCreate:"Create a new set",buttonTextCreate:"Create set",buttonTextComplete:"Done",buttonTextCancel:"Cancel",canCreateNew:!0,photoID:this.photoId}),n.appContext=this.appContext,n.buildContainer(),r=n.get("container"),this.addToSetDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),this.addToSetDialog.show(),n.activate(),e.rapidTracker.beacon(this.name,"addToSetsClick")},handleDeletePhotoClick:function(t){t.preventDefault();var n,r,i;this.moreMenu.hide(),n=this.templates("delete-photo-dialog-content")({}),r=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Delete",icon:"ui-icon-big-delete",content:n,confirmButtonLabel:"Delete Photo",confirmButtonClass:"ui-dialog-button-negative"}),r.render(),r.activate(),i=r.get("container"),r.registerEventHandler(i.one(".ui-dialog-button-confirm").on("click",this.handleDeletePhotoConfirmClick,this)),this.deleteDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:r.get("container"),appContext:this.appContext}),this.deleteDialog.show(),e.rapidTracker.beacon(this.name,"deletePhotoClick")},handleReplacePhotoClick:function(t){t.halt();var n=this.get("container"),r=this;this.moreMenu.hide(),this.replaceDialog=e.Views.dialog.getNewInstance("dialog-cta",{id:"replace-"+this.photoId,attrs:{icon:"replace"},template:"dialog-cta-reboot",content:this.templates("replace-photo-dialog-content"),parent:this,rootEl:n.ancestor(".photo-page-view")}),this.replaceDialog.attachEvents({"input change:":function(e){e.halt();var t=e.target.getDOMNode().files[0];if(!t)return;r._imgFile=t,r.replaceConfirm()},":submit":function(){r.replaceSubmit()}}),this.replaceDialog.on("hide",function(){r._imgFileXhr&&r._imgFileXhr.abort(),r._imgFileXhr=null,r._imgFile=null,r.replaceDialog.destroy(),r.replaceDialog=null}),this.replaceDialog.show(),e.rapidTracker.beacon(this.name,"replacePhotoClick")},replaceConfirm:function(){this.replaceDialog.set("fileName",this._imgFile.name),this.replaceDialog.renderContent(),e.rapidTracker.beacon(this.name,"replacePhotoConfirmationClick")},replaceSubmit:function(){var t=new FormData,n=this,r,i,s="http://api.flickr.com/services/replace",o,u,a;this.replaceDialog.set("uploading",!0),this.replaceDialog.renderContent(),this.replaceDialog.switchToWorking(),t.append("api_key",e.config.flickr.api.site_key),t.append("csrf",e.config.flickr.csrf.token),t.append("photo",this._imgFile,this._imgFile.name),t.append("photo_id",this.photoId),r=this._imgFileXhr=new XMLHttpRequest,r.open("POST",s,!0),r.withCredentials=!0,u=function(e){var t=typeof e=="object"?e.target.statusText:e+"";n.replaceDialog.switchToWorking(!1),n.replaceDialog.set("error",!0),n.replaceDialog.renderContent(),n.appContext.error("[more-menu-view] photo-replace: error during upload ("+t+")")},a=function(e){var t,r,i;try{i=document.createElement("div"),i.innerHTML=e.target.responseText,r=i.getElementsByTagName("rsp")[0]||"",r&&(r=r.getAttribute("stat")||""),t=i.getElementsByTagName("err")[0]||"",t&&(t=t.getAttribute("msg")||"")}catch(s){r="",t=""}if(r!=="ok")return u((r||"empty")+": "+(t||"no message"));n.replaceDialog.close(),document.location.reload()},r.addEventListener("load",a),r.addEventListener("error",u),o=n.replaceDialog.get("container").one("progress").getDOMNode(),r.upload.addEventListener("progress",function(e){o.value=i=Math.floor(100*(e.loaded/e.total)),e.loaded===e.total&&o.removeAttribute("value")}),r.send(t)},handleRotatePhotoClick:function(t){t.halt();var n=this.get("container"),r=this,i=240;this.moreMenu.hide(),this.rotateDialog=e.Views.dialog.getNewInstance("dialog-cta",{id:"rotate-"+this.photoId,attrs:{},template:"dialog-cta-reboot",content:this.templates("rotate-photo-dialog-content"),parent:this,rootEl:n.ancestor(".photo-page-view")}),this.rotateDialog.attachEvents({":select":function(t,n){r.rotateDialog.switchToLocked(!1),t.target.ancestor(".c-rotations").all("img").removeClass("c-state-selected"),t.target.addClass("c-state-selected"),r._imgRotation=e.flutil.constrainToValues(n.rotation,["90","180","270"])},":submit":function(){r.rotateSubmit()}}),this.rotateDialog.on("hide",function(){r.rotateDialog.destroy(),r.rotateDialog=null}),this.rotateDialog.set("preview",this.get("photo").getSizeToFit({width:i,height:i})),this.rotateDialog.switchToLocked(),this.rotateDialog.show(),e.rapidTracker.beacon(this.name,"rotatePhotoClick")},rotateSubmit:function(){var t=this;this.rotateDialog.switchToWorking(),e.rapidTracker.beacon(this.name,"rotatePhotoConfirmationClick"),this.appContext.flickrAPI.callMethod("flickr.photos.transform.rotate",{photo_id:this.photoId,degrees:this._imgRotation}).then(function(){setTimeout(function(){t.rotateDialog.close(),document.location.reload()},2e3)},function(e){t.rotateDialog.switchToWorking(!1),t.rotateDialog.set("error",!0),t.rotateDialog.renderContent(),t.appContext.error("[more-menu-view] photo-rotate: error during rotation ("+e.toString()+")")})},handleEditAviaryClick:function(t){t.halt();var n=this;this.moreMenu.hide(),this.aviary=new e.Views.Aviary({attrs:{},photo:this.get("photo"),appContext:this.appContext}),this.aviary.show(),this.on("destroy",function(){n.aviary.destroy()}),e.rapidTracker.beacon(this.name,"editAviary")},handleDeletePhotoConfirmClick:function(t){var n=this;e.rapidTracker.beacon(this.name,"deletePhotoConfirmationClick"),n.deleteDialog.close(),n.deleteDialog.destroy(),this.appContext.flickrAPI.callMethod("flickr.photos.delete",{photo_id:this.photoId}).then(function(e){var t=n.get("photo").getValue("owner");window.location="/photos/"+(t.getValue("pathAlias")||t.getValue("nsid"))+"/?deleted="+n.photoId},function(e){n.onError("There was a problem deleting this photo")})},handleCommentPermissionClick:function(t){t.preventDefault();var n=this.get("photoPrivacy"),r
,i,s;this.moreMenu.hide(),r=this.templates("photo-comment-permission-dialog-content")({currentCommentPermissionValue:n.getValue("permComment")}),i=new e.Views["confirmation-dialog-view"]({photoID:this.photoId,appContext:this.appContext,title:"Commenting",icon:"ui-icon-big-commenting",content:r,confirmButtonLabel:"Save Setting"}),i.render(),i.activate(),s=i.get("container"),i.registerEventHandler(s.one(".ui-dialog-button-confirm").on("click",this.handleCommentPermissionConfirmClick,this)),this.commentingDialog=e.Views.dialog.getNewInstance("dialog-modal",{content:i.get("container"),appContext:this.appContext}),this.commentingDialog.show(),e.rapidTracker.beacon(this.name,"photoCommentPermissionClick")},handleCommentPermissionConfirmClick:function(t){e.rapidTracker.beacon(this.name,"photoCommentPermissionConfirmationClick");var n=this.get("photoPrivacy"),r=this.commentingDialog.get("container").all("[name=photo-commenting]"),i=r.get("value"),s=r.get("checked"),o;this.commentingDialog.close(),this.commentingDialog.destroy(),o=s.indexOf(!0);if(o===-1)return;n.setValue("permComment",i[o]),n.remoteUpdate()},handleUnimplementedClick:function(t){var n=this.get("container"),r=this.templates("reboot-unimplemented-feature-dialog-content")({"opt-out-enabled":this.appContext.experiments.optOut.enabled()}),i=[];this.moreMenu.hide(),this.unimplementedFeatureDialog||(this.appContext.experiments.optOut.enabled()&&i.push({buttonMarkup:new e.Handlebars.SafeString(this.templates("photo-opt-out")({"redirect-url":window.location.pathname}))}),this.unimplementedFeatureDialog=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Zoinks!",hideConfirmButton:!0,useCancelButton:!0,cancelButtonText:"Cancel",verticalButtonList:!0,additionalButtons:i},content:r,parent:this,rootEl:n.ancestor(".photo-page-view")})),this.unimplementedFeatureDialog.show(),e.rapidTracker.beacon(this.name,"moreMenuUnimplementedFeatureClick")},handleAddLocationClick:function(t){var n=this.get("photo"),r=n.getValue("id"),i=this.get("container"),s=this.templates("temporary-organizr-dialog-content")();this.moreMenu.hide(),this.addLocationDialog||(this.addLocationDialog=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"Map it!",hideConfirmButton:!0,useCancelButton:!0,cancelButtonText:"Cancel",verticalButtonList:!0,additionalButtons:[{buttonMarkup:new e.Handlebars.SafeString('<a class="ui-button" href="/photos/organize/?batch_geotag=1&ids='+r+"&from_geo_ids="+r+'" target="_blank"><span>Open In Organizr</span></a>')}]},content:s,parent:this,rootEl:i.ancestor(".photo-page-view")})),this.addLocationDialog.show(),e.rapidTracker.beacon(this.name,"moreMenuAddLocationClick")},handleAddPeopleClick:function(t){var n=this.get("photo"),r=n.getValue("id"),i=this.get("container"),s=this.templates("temporary-organizr-dialog-content")();this.moreMenu.hide(),this.addPeopleDialog||(this.addPeopleDialog=e.Views.dialog.getNewInstance("dialog-cta",{attrs:{title:"People tagging!",hideConfirmButton:!0,useCancelButton:!0,cancelButtonText:"Cancel",verticalButtonList:!0,additionalButtons:[{buttonMarkup:new e.Handlebars.SafeString('<a class="ui-button" href="/photos/organize/?ids='+r+'&edit_pop=add_people" target="_blank"><span>Open In Organizr</span></a>')}]},content:s,parent:this,rootEl:i.ancestor(".photo-page-view")})),this.addPeopleDialog.show(),e.rapidTracker.beacon(this.name,"moreMenuAddPeopleClick")},activate:function(){var t=this,n=this.get("container"),r,i={};return this.appContext.experiments.fullscreen.getMode()||(this.setupDropdown(),r=t.moreMenu.get("container"),this.registerEventHandler(e.on("flickr:photo-sidebar-action-more-expand",function(){this.moreMenu.toggle()},this))),n&&this.registerEventHandler(n.on("click",this.handleMenuButtonClick,this)),this.appContext.experiments.fullscreen.getMode()||this.appContext.auth.signedIn&&(this.appContext.getModel("person-preferences-models",this.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),i.flagMenuItem=r.one(".flag-photo"),i.flagMenuItem&&i.flagMenuItem.on("click",t.handleFlagPhotoClick,t)}),this.appContext.getModel("photo-privacy-models",this.get("photo").getValue("id")).then(function(e){t.set("photoPrivacy",e),i.commentMenuItem=r.one(".comment-control-photo"),i.commentMenuItem&&i.commentMenuItem.on("click",t.handleCommentPermissionClick,t),i.reportPhotoMenuItem=r.one(".report-photo"),i.reportPhotoMenuItem&&i.reportPhotoMenuItem.on("click",function(){document.location="/abuse/"},t)}),i.deleteMenuItem=r.one(".delete-photo"),i.deleteMenuItem&&i.deleteMenuItem.on("click",t.handleDeletePhotoClick,t),i.rotateMenuItem=r.one(".rotate-photo"),i.rotateMenuItem&&i.rotateMenuItem.on("click",t.handleRotatePhotoClick,t),i.replaceMenuItem=r.one(".replace-photo"),i.replaceMenuItem&&i.replaceMenuItem.on("click",t.handleReplacePhotoClick,t),i.aviaryMenuItem=r.one(".edit-aviary"),i.aviaryMenuItem&&i.aviaryMenuItem.on("click",t.handleEditAviaryClick,t),i.addToSetItem=r.one(".add-to-set"),i.addToSetItem&&i.addToSetItem.on("click",t.handleAddToSetClick,t),i.addToGalleryItem=r.one(".add-to-gallery"),i.addToGalleryItem&&i.addToGalleryItem.on("click",t.handleAddToGalleryClick,t),i.addToGroupItem=r.one(".add-to-group"),i.addToGroupItem&&i.addToGroupItem.on("click",t.handleAddToGroupClick,t),i.addLocationItem=r.one(".add-location"),i.addLocationItem&&i.addLocationItem.on("click",t.handleAddLocationClick,t),i.addPeopleItem=r.one(".add-people"),i.addPeopleItem&&i.addPeopleItem.on("click",t.handleAddPeopleClick,t),i.unimplementedMenuItems=r.all(".unavailable-feature"),i.unimplementedMenuItems&&i.unimplementedMenuItems.on("click",t.handleUnimplementedClick,t)),this}})},"@VERSION@",{requires:["flickr-view","dialog","flutil","hermes-templates-dialog-cta-reboot","flickr-promise","aviary","more-menu-css","confirmation-dialog-view","set-selection-dialog-view","gallery-selection-dialog-view","group-selection-dialog-view","hermes-templates-more-button","hermes-templates-more-menu","hermes-templates-temporary-organizr-dialog-content"
,"hermes-templates-flag-photo-dialog-content","hermes-templates-delete-photo-dialog-content","hermes-templates-replace-photo-dialog-content","hermes-templates-rotate-photo-dialog-content","hermes-templates-photo-comment-permission-dialog-content","hermes-templates-reboot-unimplemented-feature-dialog-content","hermes-templates-photo-opt-out"],optional:["set-models"]});
YUI.add("photo-sidebar-actions-view",function(e){e.namespace("Views")[this.name]=e.Base.create("photo-sidebar-actions-view",e.FlickrView,[],{subviewConfig:{"fave-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"more-menu-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1}},initializer:function(e){return this.photoId=e.photoId,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.realFullscreen=!!e.realFullscreen,this.signinPendingQueue=e.signinPendingQueue,this},loadState:function(){var t=this;return e.batch(t.appContext.getModel("photo-engagement-models",t.photoId),t.appContext.getModel("photo-models",t.photoId)).then(function(e){t.set("photo-engagement",e[0]),t.set("photo",e[1])})},buildContainer:function(){var e=this.get("photo-engagement"),t;return t=this.templates("photo-sidebar-actions")({photo:e.toJSON(),"fave-view":this.subviews["fave-view"].get("container"),"more-menu-view":this.subviews["more-menu-view"].get("container"),realFullscreen:this.realFullscreen}),this.setContainerHTML(t),this},commentClicked:function(t){function o(){e.SigninHelper.addPendingComment({id:self.photoId})}var n,r,i,s;t.preventDefault(),t.stopPropagation(),this.realFullscreen&&this.appContext.getViewer().signedIn?(e.fire("flickr:photo-sidebar-fullscreen-expand"),setTimeout(function(){e.fire("flickr:photo-sidebar-actions-focus-comment-form")},500)):this.appContext.getViewer().signedIn?(i=this.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"),i&&i.focus()):(n=new e.Views["confirmation-dialog-view"]({title:"Sign in",icon:"ui-icon-big-error",heading:"Just a second!",content:"You must be signed in to comment. You will be redirected to signin now.",confirmButtonLabel:"Sign in",cancelButtonLabel:"Forget it"}),n.render(),n.activate(),r=e.Views.dialog.getNewInstance("dialog-modal",{content:n.get("container"),appContext:this.appContext}),r.show(),s=setTimeout(o,2500),n.registerEventHandler(n.get("container").one(".ui-dialog-button-confirm").on("click",o),n.get("container").one(".ui-dialog-button-cancel").on("click",function(){clearTimeout(s)})),r.registerEventHandler(r.on("dismiss",function(e){clearTimeout(s)}))),e.rapidTracker.beacon(this.name,"commentActionBarButtonClick")},moreClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"detailedViewActionBarButtonClick")},downloadClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"downloadActionBarButtonClick")},infoClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"infoActionBarButtonClick")},shareClicked:function(t){var n=this,r=this.subviews["share-view"];t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"shareActionBarButtonClick");if(r)return r[r.isVisible()?"hide":"show"]();this.appContext.getView("share-view",{photoId:this.get("photo-engagement").id,anchorTo:n.get("container").one(".share"),attrs:{arrow:!0},parent:this}).then(function(e){n.subviews["share-view"]=e,e.switchToLoading(),e.initialize().then(function(){e.show()})}).then(null,function(e){n.appContext.warn(e)})},activate:function(){var t=this.get("container"),n,r=this;return t&&(t.one(".comment")&&this.registerEventHandler(t.one(".comment").on("click",this.commentClicked,this)),t.one(".share")&&this.registerEventHandler(t.one(".share").on("click",this.shareClicked,this)),this.registerEventHandler(e.on("flickr:photo-sidebar-actions-focus-comment-form",function(){n=r.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"),n&&n.focus()})),this.appContext.experiments.fullscreen.getMode()&&(t.one(".more")&&this.registerEventHandler(t.one(".more").on("click",this.moreClicked,this)),t.one(".download")&&this.registerEventHandler(t.one(".download").on("click",this.downloadClicked,this)),t.one(".info")&&this.registerEventHandler(t.one(".info").on("click",this.infoClicked,this)))),this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",function(e){e.commentCount&&t.one(".comment span.button-comment-count").set("text",e.commentCount.newVal)})),this}})},"@VERSION@",{requires:["flickr-view","flickrui-css","hermes-templates-photo-sidebar-actions","photo-sidebar-actions-css","share-view","dialog","signin-helper"],optional:["fave-view","more-menu-view","photo-engagement-models"]});
YUI.add("hermes-templates-comment",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n			<img src="'+l((r=(r=(r=e.author,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r["default"]),typeof r===f?r.apply(e):r))+'" width="25" height="25">\n		',n}function d(e,t){var n="",r;return n+='\n			<img src="'+l((r=(r=e.author,r==null||r===!1?r:r.buddyicon),typeof r===f?r.apply(e):r))+'" width="25" height="25">\n		',n}function v(e,t){var r="",i,s;r+='\n				<a href="#" class="comment-reply" data-pathalias="'+l((i=(i=e.author,i==null||i===!1?i:i.pathAlias),typeof i===f?i.apply(e):i))+'" data-action="reply">reply</a>\n				',s=n["if"].call(e,e.canCommentBeDeleted,{hash:{},inverse:c.noop,fn:c.program(6,m,t),data:t});if(s||s===0)r+=s;return r+="\n			",r}function m(e,t){var r="",i;return r+='\n					| <a href="#" class="comment-delete" data-id="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'" data-action="delete">delete</a>\n				',r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<li class="comment">\n	<div class="comment-icon circle-icon">\n		<a href="/photos/'+l((o=(o=t.author,o==null||o===!1?o:o.pathAlias),typeof o===f?o.apply(t):o))+'/" data-track="commentBuddyIconClick">\n		',u=n["if"].call(t,(o=(o=t.author,o==null||o===!1?o:o.buddyicon),o==null||o===!1?o:o["default"]),{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;s+='\n		</a>\n	</div>\n	\n	<p class="comment-author">\n		<a href="/photos/'+l((o=(o=t.author,o==null||o===!1?o:o.pathAlias),typeof o===f?o.apply(t):o))+'/" data-track="commentUserNameClick">\n			',a={hash:{},data:i},s+=l((o=n.truncate,o?o.call(t,(o=t.author,o==null||o===!1?o:o.displayname),20,a):h.call(t,"truncate",(o=t.author,o==null||o===!1?o:o.displayname),20,a)))+'\n		</a>\n		<span class="comment-actions">\n			',u=n["if"].call(t,t.isSignedIn,{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(u||u===0)s+=u;return s+='\n		</span>\n	</p>\n	<div class="comment-date"><a href="',(u=n.permalink)?u=u.call(t,{hash:{},data:i}):(u=t.permalink,u=typeof u===f?u.apply(t):u),s+=l(u)+'" data-track="commentPermalinkClick">',(u=n.timeago)?u=u.call(t,{hash:{},data:i}):(u=t.timeago,u=typeof u===f?u.apply(t):u),s+=l(u)+'</a></div>\n	<div class="comment-content">',a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup,o?o.call(t,t.content,a):h.call(t,"renderTrustedMarkup",t.content,a)))+"</div>\n</li>\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/comment"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-comments",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function u(e,t){var r="",i;r+="\n	<ul class='comments'>\n		",i=n.each.call(e,e.comments,{hash:{},inverse:o.noop,fn:o.program(2,a,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n",r}function a(e,t){var i="",s;i+="\n			",s=o.invokePartial(r.comment,"comment",e,n,r,t);if(s||s===0)i+=s;return i+="\n		",i}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,r=r||e.partials,i=i||{};var s,o=this;return s=n["if"].call(t,t.comments,{hash:{},inverse:o.noop,fn:o.program(1,u,i),data:i}),s||s===0?s:""}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each(["comment"],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/comments"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base","hermes-templates-comment"]});
YUI.add("hermes-templates-comment-form",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\n		<div class="comment-icon circle-icon">\n			',s=n["if"].call(e,(i=(i=e.user,i==null||i===!1?i:i.buddyicon),i==null||i===!1?i:i.medium),{hash:{},inverse:f.program(4,h,t),fn:f.program(2,c,t),data:t});if(s||s===0)r+=s;return r+='\n		</div>\n		<div class="comment-form-field">\n			<textarea name="comment" placeholder="Add a comment" data-notutorial="Add a comment" data-tutorial="press Enter to post and Shift+Enter for newline" data-action="comment"></textarea>\n		</div>\n	',r}function c(e,t){var n="",r;return n+='\n				<img src="'+a((r=(r=(r=e.user,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r.medium),typeof r===u?r.apply(e):r))+'" width="25" height="25" />\n			',n}function h(e,t){var n="",r;return n+='\n				<img src="'+a((r=(r=(r=e.user,r==null||r===!1?r:r.buddyicon),r==null||r===!1?r:r["default"]),typeof r===u?r.apply(e):r))+'" width="25" height="25" />\n			',n}function p(e,t){return'\n		<div class="comment-form-field is-logged-out">\n			<a href="#"></a>\n			<textarea name="comment" disabled placeholder="You must be signed in to post a comment" data-action="comment"></textarea>\n		</div>\n	'}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="comments-form">\n	',o=n["if"].call(t,t.user,{hash:{},inverse:f.program(6,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/comment-form"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-comments-view",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var i="",s;i+="\n		",s=u.invokePartial(r["comment-form"],"comment-form",e,n,r,t);if(s||s===0)i+=s;return i+="\n	",i}function c(e,t){var r="",i;return r+="\n		<div class='comments-more'><a href='#'>",(i=n.showMoreCount)?i=i.call(e,{hash:{},data:t}):(i=e.showMoreCount,i=typeof i===a?i.apply(e):i),r+=f(i)+" more</a></div>\n	",r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,r=r||e.partials,i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;s+="<div class='comments-holder'>\n	",o=n["if"].call(t,t.canComment,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n	",o=u.invokePartial(r.comments,"comments",t,n,r,i);if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t.showMore,{hash:{},inverse:u.noop,fn:u.program(3,c,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each(["comment-form","comments"],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/comments-view"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base","hermes-templates-comment-form","hermes-templates-comments"]});
YUI.add("flickr-photos-comments-addComment-creator",function(e){"use strict";function t(e){var t={extras:"icon_urls"};return t.photo_id=e.photoId,t.comment_text=e.commentText,t.expand_bbml=!0,t.use_text_for_links=1,t}function n(t){var n=t[0],r=t[1],i=t[2],s={id:n.comment.author,username:n.comment.authorname,pathAlias:n.comment.pathAlias,realname:n.comment.realname,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(n.comment.iconurls),isPro:n.comment.ispro,isAdFree:n.comment.isAdFree},o=r.exists(n.comment.author)?r.proxy(n.comment.author):r.add(s);return i.add({id:n.comment.id,author:o,date:n.comment.datecreate,permalink:n.comment.permalink,content:n.comment.content})}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.photos.comments.addComment",this._processParams(t)),n.getModelRegistry("person-models"),n.getModelRegistry("comment-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-comments-addComment-creator] failed getting or processing API response:",e),e})}e.namespace("ModelCreators")["flickr-photos-comments-addComment"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
