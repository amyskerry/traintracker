YUI.add("hermes-templates-share-modal-twitter",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;r+='\n		| <select data-field="account" class="c-share-dropdown-account">\n			',s=n.each.call(e,(i=(i=e.networks,i==null||i===!1?i:i.twitter),i==null||i===!1?i:i.accounts),{hash:{},inverse:c.noop,fn:c.program(2,d,t),data:t});if(s||s===0)r+=s;return r+="\n		</select>\n		",r}function d(e,t){var r="",i;return r+='\n			<option value="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'">@',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+"</option>\n			",r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-twitter">\n	<h1>\n		<i class="ui-icon-small-twitter"></i>\n		Share on Twitter\n		',a={hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i},u=(o=n.ifCond,o?o.call(t,(o=(o=(o=t.networks,o==null||o===!1?o:o.twitter),o==null||o===!1?o:o.accounts),o==null||o===!1?o:o.length),">",1,a):h.call(t,"ifCond",(o=(o=(o=t.networks,o==null||o===!1?o:o.twitter),o==null||o===!1?o:o.accounts),o==null||o===!1?o:o.length),">",1,a));if(u||u===0)s+=u;return s+='\n	</h1>\n\n	<form class="ui-form">\n		<fieldset>\n			<legend>'+l((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'</legend>\n			<div class="c-share-twitter-charcounter">\n				<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n				<span data-field="message-counter">120</span>\n			</div>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n	<div class="c-share-compose-connect">\n		<i>&harr;</i>\n		please authorize Flickr to post on Twitter\n	</div>\n\n</div>',s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/share-modal-twitter"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-share-modal-mail",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-mail">\n\n	<h1><i class="ui-icon-small-mail"></i>Share via mail</h1>\n	<form class="ui-form">\n		<fieldset>\n			<legend>'+a((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===u?o.apply(t):o))+'</legend>\n			<input type="text" class="ui-u-1" placeholder="screen name or email" data-field="recipient">\n			<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n</div>',s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/share-modal-mail"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-share-modal-tumblr",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i,s;r+='\n		| <select data-field="account" class="c-share-dropdown-account">\n			',s=n.each.call(e,(i=(i=e.networks,i==null||i===!1?i:i.tumblr),i==null||i===!1?i:i.accounts),{hash:{},inverse:c.noop,fn:c.program(2,d,t),data:t});if(s||s===0)r+=s;return r+="\n		</select>\n		",r}function d(e,t){var r="",i;return r+='\n			<option value="',(i=n.id)?i=i.call(e,{hash:{},data:t}):(i=e.id,i=typeof i===f?i.apply(e):i),r+=l(i)+'">@',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e.name,i=typeof i===f?i.apply(e):i),r+=l(i)+"</option>\n			",r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-tumblr">\n	<h1>\n		<i class="ui-icon-small-tumblr"></i>\n		Share on Tumblr\n		',a={hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i},u=(o=n.ifCond,o?o.call(t,(o=(o=(o=t.networks,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.accounts),o==null||o===!1?o:o.length),">",1,a):h.call(t,"ifCond",(o=(o=(o=t.networks,o==null||o===!1?o:o.tumblr),o==null||o===!1?o:o.accounts),o==null||o===!1?o:o.length),">",1,a));if(u||u===0)s+=u;return s+='\n	</h1>\n\n	<form class="ui-form">\n		<fieldset>\n			<legend style="max-width: 280px;">'+l((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'</legend>\n			<select data-field="publishing" class="c-share-dropdown-publishing">\n				<option value="publish">Publish now</option>\n				<option value="queue">Add to queue</option>\n				<option value="draft">Save as draft</option>\n			</select>\n			<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n	<div class="c-share-compose-connect">\n		<i>&harr;</i>\n		please authorize Flickr to post on Tumblr\n	</div>\n\n</div>',s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/share-modal-tumblr"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-share-modal-blogger",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="ui-dialog-wrapper c-share-compose c-share-compose-blogger">\n\n	<h1><i class="ui-icon-small-blogger"></i>Share on Blogger</h1>\n\n	<form class="ui-form">\n		<fieldset>\n			<legend>'+a((o=(o=t.photo,o==null||o===!1?o:o.title),typeof o===u?o.apply(t):o))+'</legend>\n			<textarea class="ui-u-1" placeholder="Include a message" data-field="message"></textarea>\n		</fieldset>\n		<div class="ui-buttonbar ui-util-alignright">\n			<button type="submit" class="ui-button ui-button-cta" data-action="post"><span>Share Photo</span></button>\n		</div>\n	</form>\n\n	<div class="c-share-compose-connect">\n		<i>&harr;</i>\n		please authorize Flickr to post on Blogger\n	</div>\n\n</div>',s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/share-modal-blogger"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-share-link",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<a href="http://www.flickr.com'+f((o=(o=t.model,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'" title="',u={hash:{},data:i},s+=f((o=n.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",u):l.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",u)))+'">',u={hash:{},data:i},s+=f((o=n.fallback,o?o.call(t,(o=t.model,o==null||o===!1?o:o.title),"Untitled",u):l.call(t,"fallback",(o=t.model,o==null||o===!1?o:o.title),"Untitled",u)))+'</a> by <a href="http://www.flickr.com'+f((o=(o=(o=t.model,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'">'+f((o=(o=(o=t.model,o==null||o===!1?o:o.owner),o==null||o===!1?o:o.displayname),typeof o===a?o.apply(t):o))+"</a> on Flickr.",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/share-link"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("share-view",function(e){var t=e.Views.dialogs["dialog-tooltip"],n={},r,i,s,o,u;u={debug:!1,transitionTimeout:2e3,defaultEmbedSize:"m",defaultTab:"html",noPlayrTab:"link",shareRedirectURL:"https://www.flickr.com/authorize.gne?client=1",networks:{facebook:{clientId:e.config.flickr.facebook.client_id,scope:"offline_access,read_stream,publish_stream,publish_actions",authorizeUrl:"https://www.facebook.com/dialog/oauth",signedOutShareUrl:"https://www.facebook.com/dialog/feed"},twitter:{signedOutShareUrl:"https://twitter.com/share"},tumblr:{signedOutShareUrl:"https://www.tumblr.com/share/photo",shareSize:"c"},pinterest:{defaultDescription:"Flickr photo",signedOutShareUrl:"https://www.pinterest.com/pin/create/button/",shareSize:"c"},blogger:{clientId:"110105599151.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/blogger",authorizeUrl:"https://accounts.google.com/o/oauth2/auth"}},css:{locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-share-autocomplete-shim",embedTabs:".c-share-linkembed",embedSizeDropdown:".c-share-linkembed-embedsizedd",embedCode:".c-share-linkembed-embedcode"}},o=e.merge(e.flutil,{log:function(){if(!u.debug||!console.log.apply)return;var e=[].slice.call(arguments);e.unshift("SHARE"),o.dump.apply(null,e)}}),e.namespace("Views")[this.name]=e.Base.create("share-view",t,[],{initializer:function(n){var r,i=["photo","photostream","set"];this.api=this.appContext.flickrAPI,this.appContext.flipper.isFlipped("https_everything")||this.desecureLinks(),t.prototype.initializer.call(this,n);while(r=i.shift())if(n[r+"Id"]){this.set("modelName",r),this.set("modelId",n[r+"Id"]);break}if(!r)throw new Error("A photo or photolist id is required");return this.set("user",this.appContext.getViewer().signedIn?{}:null),e.Views.dialog.registerView(this,this.modelId),this},initialize:function(){return this.loadState()},getPlayrUrl:function(e){var t;return t=document.location.pathname,t=t.replace(/\/+$/,""),t+="/player/",t},canShowPlayr:function(){var e=this.get("engagement"),t=this.get("privacy"),n=!1;return e&&t&&(n=e.getValue("canShare")&&t.getValue("isPublic")),n},loadState:function(){var t=this,n,r,i,s;return n=this.appContext.getModel(this.get("modelName")+"-models",this.get("modelId")),r=this.appContext.getModel(this.get("modelName")+"-privacy-models",this.get("modelId")),i=this.appContext.getModel(this.get("modelName")+"-engagement-models",this.get("modelId")),s=new e.FlickrPromise({model:n,privacy:r,engagement:i}),s.then(function(e){t.set("model",e.model),t.set("modelName",e.model.registry.name.split("-")[0]),t.set("privacy",e.privacy),t.set("engagement",e.engagement)}).then(function(){return t.mapLinkedAccounts()}).then(function(e){o.log("NETWORKS",t.get("networks")),t.openShareMenu()}).then(null,this.handleError("loadState"))},hide:function(e){var n=this;this._socialNet&&this._socialNet.close(),t.prototype.hide.call(this,function(){n.get("container").get("parentNode")&&n.openShareMenu(),e&&e()})},show:function(e){t.prototype.show.call(this,e),this.embedTabs&&this.embedTabs.refreshLayout()},desecureLinks:function(){var e;u.shareRedirectURL=u.shareRedirectURL.replace("https://","http://"),Object.keys(u.networks).forEach(function(t){e=u.networks[t],e.authorizeUrl&&(u.networks[t].authorizeUrl=e.authorizeUrl.replace("https://","http://")),e.signedOutShareUrl&&(u.networks[t].signedOutShareUrl=e.signedOutShareUrl.replace("https://","http://"))})},openShareMenu:function(){var t=this,n=this.canShowPlayr(),r=this.get("engagement");this.embedHtmlSizeDd&&this.embedHtmlSizeDd.destroy(),this.embedBbcodeSizeDd&&this.embedBbcodeSizeDd.destroy(),this.embedTabs&&this.embedTabs.destroy(),this.set("playrUrl",this.getPlayrUrl()),this.set("playr",this.appContext.flipper.isFlipped("playr")),this.set("canShowPlayr",n),this.set("isOwner",r&&r.getValue("isOwner")),this.set("content",this.templates("share")),this.renderContent();if(!this.get("model"))return;if(this.get("model").getValue("isVideo"))return;this.embedTabs=new e.Views.CharmTabs({appContext:this.appContext,container:this.get("container").one(u.css.embedTabs),selected:n?u.defaultTab:u.noPlayrTab}),n&&(this.embedHtmlSizeDd=new e.Views.Dropdown({appContext:this.appContext,container:this.embedTabs.getTab("html").contentEl.one(u.css.embedSizeDropdown),selected:u.defaultEmbedSize}),this.embedHtmlSizeDd.on("selected",function(e){t.setEmbedCode(e.value,e.listItemEl)}),this.embedHtmlSizeDd.select(u.defaultEmbedSize),this.embedBbcodeSizeDd=new e.Views.Dropdown({appContext:this.appContext,container:this.embedTabs.getTab("bbcode").contentEl.one(u.css.embedSizeDropdown),selected:u.defaultEmbedSize}),this.embedBbcodeSizeDd.on("selected",function(e){t.setEmbedCode(e.value,e.listItemEl)}),this.embedBbcodeSizeDd.select(u.defaultEmbedSize))},setEmbedCode:function(e,t){var n=t.ancestor("[data-tab]").one(u.css.embedCode),r=t.one("script").get("innerHTML").trim();n.setAttribute("value",r),n.getDOMNode().select()},openComposeDialog:function(t){var n,r=this;this._socialNet=n=new t({appContext:this.appContext,model:this.get("model"),privacy:this.get("privacy"),networks:this.get("networks"),parent:this,signedOut:!this.get("user")}),e.rapidTracker.beacon(r.name,"share"+n.get("serviceName")+"NetworkClick"),n.on("posted",function(){r.switchToUIState("complete"),e.rapidTracker.beacon(r.name,"photoSharedTo"+n.get("serviceName")),setTimeout(function(){r.hide(function(){r.switchToUIState("complete",!1),r._socialNet.close(),r._socialNet=null})},2e3)}),n.on("dismissed",function(e){r.hide(function(){r._socialNet.close(),r._socialNet=null})}),n.render(),n.activate(),r.set("content",n),r.renderContent()},openSignedOutComposeDialog:function(t){var n;this._socialNet=n=new t({appContext:this.appContext,model:this.get("model"),privacy:this.get("privacy"),networks:this.get("networks"),parent:this,signedOut:!this.get("user")}),e.rapidTracker.beacon(this.name,"share"+n.get("serviceName")+"SignedOutNetworkClick"),this._socialNet.composeSignedOut
()},openAuthorizeDialog:function(e){this.openComposeDialog(e),this._socialNet.linkAccount()},activate:function(){var e,r=this;return t.prototype.activate.call(this),e={":compose":function(e,t){e.halt();var i="Connect"+o.toCamelCase(t.network);r.openComposeDialog(n[i])},":composesignedout":function(e,t){e.halt();var i="Connect"+o.toCamelCase(t.network);r.openSignedOutComposeDialog(n[i])},":connect":function(e,t){e.halt();var i="Connect"+o.toCamelCase(t.network);this.get("user")?r.openAuthorizeDialog(n[i]):r.openComposeDialog(n[i])},":expand":function(e,t){e.halt(),r.get("container").one('[data-target="expand"]').toggleClass(u.css.removed)}},this.attachEvents(e),this},handleError:function(e,t){var n=["loadState","flickr.sharing.getServiceTypes","flickr.sharing.getServices","flickr.sharing.canShare"];return n.indexOf(e)>=0?function(t){o.log(e,!t.toString||t.toString().match(/^\[object/)?t:t.toString())}:function(t){o.log(e,!t.toString||t.toString().match(/^\[object/)?t:t.toString()),o.getOopsAlert(this.appContext).show()}.bind(this)},mapLinkedAccounts:function(){var e=this;return this.getLinkedAccounts().then(function(t){e.get("networks")||e.set("networks",{});var n=e.get("networks");Object.keys(t).forEach(function(e){n[t[e].label]=t[e]})})},getLinkedAccounts:function(){return e.batch(this.get("user")?this.api.callMethod("flickr.sharing.getServices",{}):new e.AutoResolvingPromise,this.getNetworks()).then(function(e){var t=e[0],n=e[1]||[],r;try{r=t.services.service||[]}catch(i){r=[]}return r=r.reduce(function(e,t){var n=t.typeId+"";return e[n]||(e[n]=[]),e[n].push(t),e},{}),Object.keys(n).forEach(function(e){n[e].accounts=r[n[e].id]||null}),n},this.handleError("flickr.sharing.getServices"))},getNetworks:function(){var t=this,n,r;return n=["facebook","twitter","tumblr","mail","pinterest"],r=["mail"],this.getNetworkMap().then(function(){var i={},s,o;return i[t.get("modelName")+"_id"]=t.get("model").id,t.get("user")?t.api.callMethod("flickr.sharing.canShare",i):(o=t.get("engagement").getValue("canShare")?n:r,s=o.map(function(e){var n,r,i;for(n in t._networkMap){r=t._networkMap[n],i={service_type_id:n};if(r.label===e){i.can_share=1;break}}return i.can_share||(i.can_share=0),i}),new e.AutoResolvingPromise({services:{service:s}}))}).then(function(e){var r;try{r=e.services.service||[]}catch(i){r=[]}return r.push({service_type_id:999,can_share:r.filter(function(e){return e.service_type_id.toString()==="9"&&e.can_share}).length}),r=r.filter(function(e){return e.can_share}).reduce(function(e,r){var i=r.service_type_id+"",s=t._networkMap[i]||{name:"unknown",label:i};return n.indexOf(s.label)<0?e:(e[i]={name:s.name,label:s.label,id:i},e)},{}),r},this.handleError("flickr.sharing.canShare"))},getNetworkMap:function(){var t=this;return this._networkMap={3:{label:"blogger",name:"Blogger"},5:{label:"livejournal",name:"LiveJournal"},7:{label:"wordpress",name:"WordPress"},9:{label:"twitter",name:"Twitter"},12:{label:"tumblr",name:"Tumblr"},128:{label:"facebook",name:"Facebook"},129:{label:"yahoo-pulse",name:"Yahoo Pulse"},130:{label:"mail",name:"Mail"},999:{label:"pinterest",name:"Pinterest"}},this._networkMap?new e.AutoResolvingPromise:this.api.callMethod("flickr.sharing.getServiceTypes",{}).then(function(e){var n;try{n=e.service_types.service_type||[]}catch(r){n=[]}t._networkMap=n.reduce(function(e,t){return e[t.id.toString()]={label:t.content.toLowerCase().replace(/\s+/,"-"),name:t.content},e},{})},this.handleError("flickr.sharing.getServiceTypes"))},destroy:function(){this._socialNet&&this._socialNet.close(),t.prototype.destroy.call(this)}}),r=n.Connect=function(t){this.options=e.merge(t),e.FlickrView.apply(this,arguments)},e.extend(r,e.FlickrView,{initializer:function(){this.api=this.options.appContext.flickrAPI,this.parent=this.options.parent,this.set("model",this.options.model),this.set("privacy",this.options.privacy),this.set("networks",this.options.networks),this.set("signedOut",this.options.signedOut),this.set("modelName",this.options.model.registry.name.split("-")[0]),this.set(this.get("modelName"),this.get("model"))},isPrivate:function(){var e=this.get("privacy");return!e.getValue("isPublic")&&!e.getValue("isVisibleByFriends")&&!e.getValue("isVisibleByFamily")},toJSON:function(){var t=this.getAttrs();return Object.keys(t).reduce(function(n,r){var i=t[r];return i instanceof e.Node?n:i instanceof e.FlickrView?n:(i&&i.toJSON&&(i=i.toJSON()),n[r]=i,n)},{})},render:function(){var e=this.templates(this.get("template"))(this.toJSON());return this.get("container").setHTML(e),this},activate:function(){var e={":post":this.post};return this.attachEvents(e),this},handleError:function(e,t){var n=this;return function(r){o.log(e,!r.toString||r.toString().match(/^\[object/)?r:r.toString());if(["10","12","98","99"].indexOf(r.code+"")>=0)return n.linkAccount().then(t);n.parent.handleError(n._class+":"+e)(r)}},handleRetry:function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){t[0].apply(e,t.slice(1))}},linkAccount:function(){var t=this;return new e.FlickrPromise(function(e,n){t.authorize(function(n){var r={};r.token=n.token,r.service_type_id=t.get("serviceType"),n.hasOwnProperty("expiresIn")&&(r.expires=n.expiresIn/1e3|0||0),n.hasOwnProperty("verifier")&&(r.verifier=n.verifier),t.api.callMethod("flickr.sharing.setToken",r).then(function(n){t.parent.mapLinkedAccounts().then(function(){o.log("NETWORKS-REFRESH",t.get("networks")),e()})})})})},authorize:function(t){var n=this.get("serviceName"),r,i=this;r=e.Views.dialog.getInstance("dialog-cta",{content:"You need to authorize Flickr to share photos on your "+n,attrs:{title:"Connect to "+n,confirmButtonText:"Ok, take me to my settings"},appContext:i.appContext}),r.on("confirm",function(){document.location="/account/sharing/"}),r.show()},destroy:function(){this._oauthWin&&this._oauthWin.close();var t=this.get("container");t.detach(),t.remove(),this.set("container",null),this.options=null,this.api=null,this.set("model",null),this.set("privacy",null),
e.FlickrView.prototype.destroy.call(this)},close:function(){this.destroy()}}),r.ATTRS=e.merge(e.FlickrView.ATTRS,{template:{value:"share-modal"},serviceType:{value:"000"},serviceName:{value:"Default"},container:{valueFn:function(){return e.Node.create("<div/>")}}}),n.ConnectFacebook=function(){this._class="ConnectFacebook",r.apply(this,arguments)},e.extend(n.ConnectFacebook,r,{post:function(e){var t={},n=this;return e.halt(),t[this.get("modelName")+"_id"]=this.get("model").id,t.service_type_id=this.get("serviceType"),t.facebook_privacy="friends",this.isPrivate()&&(t.guestpass_private="1"),t.message=o.escapeInput(this.get("container").one('[data-field="message"]').get("value"),"text"),o.log("POST TO FB",t),this.get("container").addClass(u.css.working),this.api.callMethod("flickr.sharing.post",t).then(function(e){n.get("container").removeClass(u.css.working),n.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,e)))},composeSignedOut:function(){var t,n,r=this;t={app_id:e.config.flickr.facebook.client_id,display:"popup",link:document.location.href,name:this.get("model").getValue("title"),description:this.get("model").getValue("description"),redirect_uri:u.shareRedirectURL},u.debug&&(t.link=t.link.replace("local.flickr.com","www.flickr.com")),o.log("ANON POST TO FB",t),this.get("container").addClass(u.css.working),n=o.buildHttpQuery(u.networks.facebook.signedOutShareUrl,t),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(n,{onClose:function(){},onUrlChange:function(){var e=r._shareWin.document.location,t=[e.protocol,"//",e.host,e.pathname].join(""),n=u.shareRedirectURL.split("?")[0];u.debug&&t.replace("local.flickr.com","www.flickr.com"),t===n&&r._shareWin.close()},ui:{}})},authorize:function(e){var t,n,r=this,i;t={client_id:u.networks.facebook.clientId,redirect_uri:u.shareRedirectURL,response_type:"token",scope:u.networks.facebook.scope,display:"popup"},n=o.buildHttpQuery(u.networks.facebook.authorizeUrl,t),i=function(){var t=r._oauthWin.location.hash||"",n;n=t.slice(1).split(/&/).reduce(function(e,t){var n=t.split(/=/);return e[n[0]]=n[1],e},{}),n.access_token&&(r._oauthWin.close(),e({token:n.access_token,expiresIn:(parseInt(n.expires_in,10)||0)*1e3}))},this._oauthWin&&this._oauthWin.close(),this._oauthWin=o.openPopupWindow(n,{onUrlChange:i,ui:{}})}}),n.ConnectFacebook.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-facebook"},serviceType:{value:"128"},serviceName:{value:"Facebook"}}),n.ConnectTwitter=function(){this._class="ConnectTwitter",r.apply(this,arguments)},e.extend(n.ConnectTwitter,r,{activate:function(){r.prototype.activate.call(this);var e=this.get("container"),t=e.one('[data-field="message"]'),n=e.one('[data-field="message-counter"]'),i,s=120;i=t.on("keydown",function(){var r=o.escapeInput(t.get("value"),"text");n.setHTML(""+(s-r.length)),n[r.length>s?"addClass":"removeClass"]("c-share-twitter-charcounter-overflow"),e[r.length>s?"addClass":"removeClass"](u.css.locked)}),this.registerEventHandler(i)},render:function(){r.prototype.render.call(this),this.accountDd=new s(this.get("container").one('[data-field="account"]'))},authorize:function(e){var t={},n=this,r=this.get("container"),i,s,a=!1;t.service_type_id=this.get("serviceType"),r.addClass(u.css.connecting),i=function(){var t=n._oauthWin.location.search||"",i=n._oauthWin.location.hostname||"",o;o=t.slice(1).split(/&/).reduce(function(e,t){var n=t.split(/=/);return e[n[0]]=n[1],e},{});if(o.oauth_token)return a=!0,n._oauthWin.close(),r.removeClass(u.css.connecting),e({token:o.oauth_token,verifier:o.oauth_verifier});i==="www.flickr.com"&&s()},s=function(){n._oauthWin.close();if(a)return;r.removeClass(u.css.connecting),n.fire("dismissed")},this.api.callMethod("flickr.sharing.getAuthorizeUrl",t).then(function(e){n._oauthWin&&n._oauthWin.close(),n._oauthWin=o.openPopupWindow(e.authorize_url,{onUrlChange:i,onClose:s,ui:{}})},this.handleError("flickr.sharing.getAuthorizeUrl"))},post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r={},i=this,s;e.halt(),r[this.get("modelName")+"_id"]=this.get("model").id,r.service_type_id=this.get("serviceType"),this.isPrivate()&&(r.guestpass_private="1");try{s=o.escapeInput(this.accountDd.selected,"numericstring"),s||(s=this.get("networks").twitter.accounts[0].id)}catch(a){return this.handleError("flickr.sharing.post")("Twitter account not found on posting")}return r.service_id=s,r.message=o.escapeInput(n.get("value"),"text"),o.log("POST TO TWITTER",r),t.addClass(u.css.working),this.api.callMethod("flickr.sharing.post",r).then(function(e){t.removeClass(u.css.working),i.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,e)))},composeSignedOut:function(){var e,t;e={url:document.location.href},u.debug&&(e.url=e.url.replace("local.flickr.com","www.flickr.com")),o.log("ANON POST TO TWITTER",e),this.get("container").addClass(u.css.working),t=o.buildHttpQuery(u.networks.twitter.signedOutShareUrl,e),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(t)},destroy:function(){this.accountDd=null,n.Connect.prototype.destroy.call(this)}}),n.ConnectTwitter.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-twitter"},serviceType:{value:"9"},serviceName:{value:"Twitter"}}),n.ConnectTumblr=function(){this._class="ConnectTumblr",r.apply(this,arguments)},e.extend(n.ConnectTumblr,r,{render:function(){r.prototype.render.call(this),this.publishingDd=new s(this.get("container").one('[data-field="publishing"]')),this.accountDd=new s(this.get("container").one('[data-field="account"]'))},authorize:n.ConnectTwitter.prototype.authorize,post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r={},i=this,s;e.halt(),r[this.get("modelName")+"_id"]=this.get("model").id,r.service_type_id=this.get("serviceType"),this.isPrivate()&&(r.guestpass_private="1");try{s=o.escapeInput(this.accountDd.selected,"numericstring"),s||(s=this.get("networks").tumblr.accounts[0].id)}catch(a){return this
.handleError("flickr.sharing.post")("Tumblr account not found on posting")}return r.service_id=s,r.status=o.constrainToValues(this.publishingDd.selected,["publish","queue","draft"]),r.message=o.escapeInput(n.get("value"),"text"),o.log("POST TO TUMBLR",r),t.addClass(u.css.working),this.api.callMethod("flickr.sharing.post",r).then(function(e){t.removeClass(u.css.working),i.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,e)))},composeSignedOut:function(){var e,t=this.get("model"),n=t.getValue("sizes"),r,i=document.location.href,s,a;r=n[u.networks.tumblr.shareSize],r||(r=t.getLargestSize(t.getValue("id"))),u.debug&&(i=i.replace("local.flickr.com","www.flickr.com")),s=this.templates("share-link")(this.toJSON()),e={source:(this.appContext.flipper.isFlipped("https_everything")?"https:":"http:")+r.url,caption:s,click_thru:i},o.log("ANON POST TO TUMBLR",e),this.get("container").addClass(u.css.working),a=o.buildHttpQuery(u.networks.tumblr.signedOutShareUrl,e),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(a)},destroy:function(){this.publishingDd=null,this.accountDd=null,n.Connect.prototype.destroy.call(this)}}),n.ConnectTumblr.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-tumblr"},serviceType:{value:"12"},serviceName:{value:"Tumblr"}}),n.ConnectPinterest=function(){this._class="ConnectPinterest",r.apply(this,arguments)},e.extend(n.ConnectPinterest,r,{render:function(e){},show:function(){},hide:function(){},activate:function(){this.post()},post:function(){var e,t,n=this.get("model"),r=n.getValue("sizes"),i=n.getValue("title")||u.networks.pinterest.defaultDescription,s;s=r[u.networks.pinterest.shareSize],s||(s=n.getLargestSize(n.getValue("id"))),e={url:document.location.href,description:i,media:(this.appContext.flipper.isFlipped("https_everything")?"https:":"http:")+s.url},t=o.buildHttpQuery(u.networks.pinterest.signedOutShareUrl,e),this._shareWin&&this._shareWin.close(),this._shareWin=o.openPopupWindow(t,{onClose:function(){},ui:{}}),this.fire("dismissed")},composeSignedOut:function(){this.post()}}),n.ConnectPinterest.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-pinterest"},serviceType:{value:"999"},serviceName:{value:"Pinterest"}}),n.ConnectBlogger=function(){this._class="ConnectBlogger",r.apply(this,arguments)},e.extend(n.ConnectBlogger,r,{post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r=t.one('[data-field="account"]'),i={},s=this;return e.halt(),i[this.get("modelName")+"_id"]=this.get("model").id,i.service_type_id=this.get("serviceType"),this.isPrivate()&&(i.guestpass_private="1"),r&&(i.service_id=o.escapeInput(r.get("value"),"numericstring")),i.message=o.escapeInput(n.get("value"),"text"),o.log("POST TO BLOGGER",i),this.get("container").addClass(u.css.working),this.api.callMethod("flickr.sharing.post",i).then(function(e){s.get("container").removeClass(u.css.working),s.fire("posted")},this.handleError("flickr.sharing.post",this.handleRetry(this.post,e)))},authorize:function(e){var t,n,r=this,i;t={client_id:u.networks.blogger.clientId,redirect_uri:u.shareRedirectURL,response_type:"token",scope:u.networks.blogger.scope},n=o.buildHttpQuery(u.networks.blogger.authorizeUrl,t),i=function(){var t=r._oauthWin.location.hash||"",n;n=t.slice(1).split(/&/).reduce(function(e,t){var n=t.split(/=/);return e[n[0]||"_empty_"]=n[1],e},{}),n.access_token&&(r._oauthWin.close(),e({token:n.access_token,expiresIn:(parseInt(n.expires_in,10)||0)*1e3}))},this._oauthWin&&this._oauthWin.close(),this._oauthWin=o.openPopupWindow(n,{onUrlChange:i,ui:{}})}}),n.ConnectBlogger.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-blogger"},serviceType:{value:"3"},serviceName:{value:"Blogger"}}),n.ConnectMail=function(){this._class="ConnectMail",r.apply(this,arguments)},e.extend(n.ConnectMail,r,{activate:function(){var e=this;r.prototype.activate.call(this),this.get("container").addClass(u.css.locked),this.contacts=new i({el:this.get("container").one('[data-field="recipient"]'),api:this.api,signedOut:this.get("signedOut"),onError:this.handleError("ContactSearchBox"),onShow:function(t){e.get("container").addClass(u.css.locked)},onSelect:function(t){t?e.get("container").removeClass(u.css.locked):e.get("container").addClass(u.css.locked)}})},post:function(e){var t=this.get("container"),n=t.one('[data-field="message"]'),r={},i=this.get("model"),s=this;e.halt();if(!this.contacts.selected)return;return r[this.get("modelName")+"_id"]=i.id,r.service_type_id=this.get("serviceType"),this.isPrivate()&&(r.guestpass_private="1"),this.contacts.selected.nsid?r.to_flickr=this.contacts.selected.nsid:this.contacts.selected.email&&(r.to_email=this.contacts.selected.email),r.message=o.escapeInput(n.get("value"),"text"),o.log("POST TO MAIL",r),this.get("container").addClass(u.css.working),this.api.callMethod("flickr.sharing.post",r).then(function(e){t.removeClass(u.css.working),s.fire("posted")},this.handleError("flickr.sharing.post"))},composeSignedOut:function(){function i(){n&&n.destroy(),e.SigninHelper.addPendingShare({shareType:"email"})}var t,n,r;this.parent.hide(),t=new e.Views["confirmation-dialog-view"]({title:"Sign in",icon:"ui-icon-big-error",heading:"Just a second!",content:"You must be signed in to email a photo. You will be redirected to signin now.",confirmButtonLabel:"Sign in",cancelButtonLabel:"Forget it"}),t.render(),t.activate(),n=e.Views.dialog.getNewInstance("dialog-modal",{content:t.get("container"),appContext:this.appContext}),n.show(),r=setTimeout(i,5e3),t.registerEventHandler(t.get("container").one(".ui-dialog-button-confirm").on("click",i),t.get("container").one(".ui-dialog-button-cancel").on("click",function(){clearTimeout(r)})),n.registerEventHandler(n.on("dismiss",function(e){clearTimeout(r)}))},handleError:function(e,t){var n=this;return function(t){n.parent.handleError(n._class+":"+e)(t)}}}),n.ConnectMail.ATTRS=e.merge(r.ATTRS,{template:{value:"share-modal-mail"},serviceType:{value:"130"},serviceName:{value:"Email"}}),i=
function(e){this.options=e,this._contacts=null,this.queryEl=this.options.el,this.listEl=null,this.init()},i.prototype={init:function(){var t=this;this.queryEl.on("keyup",this.search.bind(this)),this.wrapperEl=e.Node.create("<div/>"),this.wrapperEl.addClass("c-share-autocomplete"),this.listEl=e.Node.create("<ul/>"),this.wrapperEl.appendChild(this.listEl),this.queryEl.ancestor().insertBefore(this.wrapperEl,this.queryEl),this.wrapperEl.appendChild(this.queryEl),this.listEl.delegate("click",function(e){var n=e.target.ancestor("[data-nsid]",!0).getData("nsid");t.select(n)},"li")},getContact:function(e){var t=0,n=this._contacts,r=n.length;for(;t<r;t++)if(n[t].nsid===e)return n[t]},load:function(e){var t={},n=this;if(this._busy)return;return this._busy=!0,this.options.api.callMethod("flickr.contacts.getList",t).then(function(t){n._busy=!1;try{n._contacts=t.contacts.contact||[]}catch(r){n._contacts=[]}n._contacts.forEach(function(e){e.realname||(e.realname=e.username),e.iconfarm?(e.buddyicon="//farm"+e.iconfarm+".static.flickr.com",e.buddyicon+="/"+e.iconserver+"/buddyicons",e.buddyicon+="/"+e.nsid+".jpg"):e.buddyicon="//l.yimg.com/g/images/buddyicon06.png"}),e()},this.options.onError)},hide:function(e){e&&e.halt();if(!this._visible)return;this._visible=!1,this._shimUp(!1),this.listEl.setStyle("display","none")},show:function(){if(this._visible)return;this._visible=!0,this._shimUp(),this.listEl.setStyle("display","block"),this.options.onShow()},_shimUp:function(t){if(t===!1){if(!this._shim)return;this._shim.detach("click").remove(),this._shim=null;return}this._shim=e.Node.create("<div/>"),this._shim.addClass(u.css.shim),this._shim.on("click",this.hide.bind(this)),this.wrapperEl.appendChild(this._shim)},select:function(e){typeof e=="string"&&(e=this.getContact(e),this.queryEl.set("value",e.realname)),this.selected=e,this.options.onSelect(e),this.hide()},search:function(){var e=this.queryEl.get("value"),t,n;this.selected=null;if(this._isEmail(e))return this.select({email:e,nsid:null});if(/,/.test(e))return this.select(null);if(!this._contacts)return this.options.signedOut?null:this.load(this.search.bind(this));t=e.replace(/[^A-Z0-9]+/gi,"|").replace(/^\||\|$/g,""),n=new RegExp(t,"i"),this.showResults(this._contacts.filter(function(e){return n.test(e.username)||n.test(e.realname)||n.test(e.email)}))},_isEmail:function(e,t){/,/.test(e)?e=e.split(/,/):e=[e];var n=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;if(t){while(e.length)if(n.test(e.shift().trim()))return!0;return!1}while(e.length)if(!n.test(e.shift().trim()))return!1;return!0},showResults:function(e){var t=10,n,r=this;if(!e.length)return this.hide();n=document.createDocumentFragment(),e.slice(0,t).forEach(function(e){var t=r.createItem(e);n.appendChild(t)}),this.listEl.setHTML(""),this.listEl.getDOMNode().appendChild(n),this.show()},_template:['<img src="{{buddyicon}}">',"<h2>{{realname}}</h2>","<h3>{{username}}</h3>"].join(""),createItem:function(e){var t=document.createElement("li"),n;return n=this._template.replace(/\{\{(\w+)\}\}/g,function(t,n){return o.escapeInput(e[n])}),t.innerHTML=n,t.dataset.nsid=e.nsid,t}},s=function(e,t){this.options=t,this._items=[],this.el=e,this.containerEl=null,this.listEl=null,this.labelEl=null,this.selected=null,this._open=!0,this._handlers=[],this._init()},s.prototype={_init:function(){if(!this.el)return;this._render(),this._handlers=[this.containerEl.delegate("click",this._onClick,"span, li",this)]},_render:function(){var t=this.el.getDOMNode(),n,r,i,s;s="ui-dropdown "+this.el.getDOMNode().className,this.containerEl=e.Node.create('<div class="'+s+'"/>'),this.listEl=n=e.Node.create("<ul/>"),this.labelEl=e.Node.create("<span/>"),this._items=r={},Array.prototype.slice.call(t.options).forEach(function(t){var i,s;i=r[t.value]={value:t.value,label:t.text},s=e.Node.create("<li/>"),s.set("text",i.label),s.setAttribute("data-value",i.value),n.appendChild(s)}),this.containerEl.appendChild(this.labelEl),this.containerEl.appendChild(this.listEl),this.el.setStyle("display","none"),this.el.insert(this.containerEl,"before"),i=t.options[t.selectedIndex]||{},this.select(i.value)},_onClick:function(e){var t=e.target,n=t.get("tagName").toLowerCase();if(n==="li")return this.select(t.getData("value"));if(n==="span")return this.toggle()},select:function(e){this.selected=e||null,this.labelEl.set("text",this.selected?this._items[this.selected].label:"..."),this.close()},open:function(){this._open=!0,this.listEl.setStyle("display","block")},close:function(){this._open=!1,this.listEl.setStyle("display","none")},toggle:function(){this[this._open?"close":"open"]()},destroy:function(){this._handlers.forEach(function(e){e.detach()}),this._handlers=null,this._items=null,this.el=null,this.containerEl=null,this.listEl=null,this.labelEl=null,this.selected=null}}},"@VERSION@",{requires:["flutil","dialog","dropdown","charmtabs","flickr-promise","hermes-templates-share","hermes-templates-share-modal-facebook","hermes-templates-share-modal-twitter","hermes-templates-share-modal-mail","hermes-templates-share-modal-tumblr","hermes-templates-share-modal-blogger","hermes-templates-share-link"],optional:["photo-models","photostream-models","share-css"]});
YUI.add("hermes-templates-fave",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){return"is-faved"}function h(e,t){return"can-not-fave"}function p(e,t){var r,i;return i={hash:{},data:t},f((r=n.formatNumber,r?r.call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),i):a.call(e,"formatNumber",(r=e.photo,r==null||r===!1?r:r.faveCount),i)))}function d(e,t){var r,i;return i={hash:{},data:t},f((r=n.friendlyNumber,r?r.call(e,(r=e.photo,r==null||r===!1?r:r.faveCount),i):a.call(e,"friendlyNumber",(r=e.photo,r==null||r===!1?r:r.faveCount),i)))}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<a href="#" title="Fave this photo" class="button">\n	<span class="hide-text fave-star ',u=n["if"].call(t,(o=t.photo,o==null||o===!1?o:o.isFaved),{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(u||u===0)s+=u;s+=" ",u=n.unless.call(t,(o=t.photo,o==null||o===!1?o:o.canFave),{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(u||u===0)s+=u;s+='">&9733;</span>\n	<span class="fave-count">',u=n["if"].call(t,t.realFullscreen,{hash:{},inverse:l.program(7,d,i),fn:l.program(5,p,i),data:i});if(u||u===0)s+=u;return s+="</span>\n</a>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/fave"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("fave-view",function(e){e.namespace("Views")[this.name]=e.Base.create("fave-view",e.FlickrView,[],{initializer:function(e){return this.photoId=e.photoId,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.realFullscreen=!!e.realFullscreen,this},buildContainer:function(){var e=this.get("photo-engagement"),t;return t=this.templates("fave")({photo:e.toJSON(),realFullscreen:this.realFullscreen}),this.setContainerHTML(t),this},loadState:function(){var e=this;return this.appContext.getModel("photo-engagement-models",this.photoId).then(function(t){e.set("photo-engagement",t)})},activate:function(){var t=this.get("container"),n=this.get("photo-engagement"),r=this;return n&&this.registerEventHandler(n.on("valuesChanged",function(t){r.buildContainer();var i=n.remoteUpdate();i.then(null,function(i){if(i.code!==3){e.Object.each(t,function(e,t){n.setValue(t,e.prevVal)});var s=e.Views.dialog.getInstance("dialog-alert",{content:"Error! We couldn't fave at this time.",attrs:{level:"warning"},appContext:r.appContext});s.show()}}).then(null,function(t){e.Flog.error(t.message),e.Flog.error(t.stack)})},this.photoId)),t&&this.registerEventHandler(t.delegate("click",this.faveClicked,"a.button",this)),this.registerEventHandler(this.appContext.getKeyboardManager().on("down:70",this.faveClicked.bind(this))),this},faveClicked:function(t){var n=this,r=n.get("photo-engagement"),i;t.preventDefault(),n.appContext.getViewer().signedIn?r.getValue("canFave")&&(r.registry.toggleFave(n.photoId),e.rapidTracker.beacon(this.name,"faveActionBarButtonClick")):(i=e.Views.dialog.getInstance("dialog-alert",{content:"You must be signed in to fave. You will be redirected to signin now.",attrs:{level:"warning"},appContext:n.appContext}),i.show(),setTimeout(function(){e.SigninHelper.addPendingFave({id:n.photoId})},2500))}})},"@VERSION@",{requires:["flickr-view","hermes-templates-fave","fave-css","dialog","signin-helper"],optional:["photo-engagement-models"]});
YUI.add("hermes-templates-dialog-cta-reboot",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n		<h1 class="ui-dialog-title">'+l((r=(r=e.attrs,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+"</h1>\n	",n}function d(e,t){var n="",r;return n+='\n		<div class="ui-dialog-icon">\n			<i class="ui-icon-big-'+l((r=(r=e.attrs,r==null||r===!1?r:r.icon),typeof r===f?r.apply(e):r))+'"></i>\n		</div>\n	',n}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="ui-dialog-wrapper ui-dialog ui-dialog-cta ui-dialog-cta-reboot">\n	',u=n["if"].call(t,(o=t.attrs,o==null||o===!1?o:o.title),{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n	",u=n["if"].call(t,(o=t.attrs,o==null||o===!1?o:o.icon),{hash:{},inverse:c.noop,fn:c.program(3,d,i),data:i});if(u||u===0)s+=u;return s+='\n\n	<div class="ui-dialog-body">\n		',a={hash:{},data:i},s+=l((o=n.dialogOutlet,o?o.call(t,t.content,a):h.call(t,"dialogOutlet",t.content,a)))+"\n	</div>\n</div>\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/dialog-cta-reboot"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-aviary",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="ui-dialog-wrapper ui-dialog ui-dialog-modal c-aviary">\n	<div class="c-aviary-progress"></div>\n	<button class="c-aviary-closebutton" data-action="cancel"></button>\n	<div class="c-aviary-popups"></div>\n	<div class="ui-dialog-body">\n		',u={hash:{},data:i},s+=f((o=n.dialogOutlet,o?o.call(t,t.content,u):a.call(t,"dialogOutlet",t.content,u)))+"\n	</div>\n</div>\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/aviary"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-aviary-dialog-authorize",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{},'<div class="ui-dialog-wrapper">\n	<div class="ui-dialog-description">\n			<p>Aviary Photo Editor wants to link to your Flickr account.</p>\n\n			<p>\n				By authorizing this link, you\'ll allow Aviary Photo Editor to:\n				<ul>\n					<li>Access your Flickr account (including private content)</li>\n					<li>Upload, Edit, and Replace photos and videos in your account</li>\n					<li>Interact with other members\' photos and videos (comment, add notes, favorite)</li>\n				</ul>\n				Aviary Photo Editor will not have permission to delete photos and videos from your account\n			</p>\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button ui-button-cta" data-action="confirm"><span>Authorize</span></button>\n		<button class="ui-button c-button-cancel" data-action="dismiss"><span>Cancel</span></button>\n	</div>\n</div>\n'}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/aviary-dialog-authorize"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-aviary-dialog-confirmcancel",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){return this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{},'<div class="ui-dialog-wrapper">\n	<div class="ui-dialog-description">\n		If you close this window all the changes you made to this photo will be lost. Are you sure you want to continue?\n	</div>\n	<div class="ui-buttonbar ui-dialog-buttonbar">\n		<button class="ui-button ui-button-cta" data-action="confirm"><span>Sure, go ahead</span></button>\n		<button class="ui-button c-button-cancel" data-action="dismiss"><span>Cancel</span></button>\n	</div>\n</div>\n'}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/aviary-dialog-confirmcancel"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("aviary",function(e){var t=e.Views.dialogs["dialog-modal"],n,r,i;i={debug:!1,redirect:{created:"/photos/{{pathAlias}}/{{photoId}}"},aviary:{frameUrl:"http://flickr.aviary.com/default.aspx",locale:"en-us"},css:{connecting:"c-aviary-state-connecting",popups:".c-aviary-popups",uploading:"c-aviary-state-uploading"}},r=e.merge(e.flutil,{log:function(){if(!i.debug||!console.log.apply)return;var e=[].slice.call(arguments);e.unshift("SHARE"),r.dump.apply(null,e)}}),n=e.namespace("Views").Aviary=e.Base.create("Aviary",t,[],{initializer:function(n){return t.prototype.initializer.call(this,n),this.set("user",this.appContext.getViewer().signedIn?{}:null),this.set("owner",this.get("photo").getValue("owner")),e.Views.dialog.registerView(this,this.get("photo").getValue("id")),this.initialize(),this},initialize:function(){this.on("rendered",this.renderFrame,this),this._aviaryEvents=[["load",function(e){return e.pageLoaded}],["edited",function(e){return e.type==="replace"&&e.editSuccessful}],["created",function(e){return e.type==="new"&&e.editSuccessful}]],this._aviaryEvents.handleCommand=this.handleCommand.bind(this),window.addEventListener("message",this._aviaryEvents.handleCommand),this.attachEditorEvents()},attachEditorEvents:function(){var e=this;this.on("authorize",function(t){e.confirmAuthorize(function(){t.authForm.submit()})}),this.on("load",function(t){e.get("container").removeClass(i.css.connecting)}),this.on("edited",function(t){e.get("container").addClass(i.css.uploading),clearTimeout(e._aviaryEvents.editedTimer),e._aviaryEvents.editedTimer=setTimeout(function(){document.location.reload()},1e3)}),this.on("created",function(t){e.get("container").addClass(i.css.uploading),clearTimeout(e._aviaryEvents.createdTimer),e._aviaryEvents.createdTimer=setTimeout(function(){var n=i.redirect.created;n=n.replace("{{pathAlias}}",e.get("owner").getValue("pathAlias")),n=n.replace("{{photoId}}",t.photo_id),document.location=n},1e3)})},handleCommand:function(e){var t,n,r;try{t=JSON.parse(e.data)}catch(i){t={}}for(n=0,r=this._aviaryEvents.length;n<r;n++)if(this._aviaryEvents[n][1](t))return this.fire(this._aviaryEvents[n][0],t)},renderFrame:function(){var t,n,r,s,o,u,a,f;self=this,this.get("container").addClass(i.css.connecting),u=this.get("photo").getSizeToFit({width:this.get("width")|0,height:this.get("height")|0}).url,f=this.get("photo").getValue("sizes");for(a in f)if(f[a].url===u)break;t=e.flutil.template("{{baseUrl}}?id={{photoId}}&intl={{locale}}&big=1&viewport_width={{width}}&viewport_height={{height}}&image_size={{imageSize}}&cachebust=6",{baseUrl:i.aviary.frameUrl,locale:i.aviary.locale,width:this.get("width")|0,height:this.get("height")|0,imageSize:a,photoId:this.get("photo").getValue("id")}),this.iframe=e.Node.create("<iframe/>"),this.iframe.setAttribute("seamless","seamless"),this.iframe.setAttribute("frameborder","0"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("marginwidth","0"),this.iframe.setStyles({width:this.get("width")+"px",height:this.get("height")+"px"}),this.iframe.set("src",t),this.set("content",this.iframe),this.renderContent(),n=this.iframe.getDOMNode(),r=function(e,t,n,i){if(!--i)return;if(n&&n())return;if(t())return e();setTimeout(function(){r(e,t,n,i)},100)},s=function(){r(o,function(){return n.contentDocument.querySelector('form[method="post"]')},function(){return!n.contentDocument.location.host},50)},o=function(){var e=n.contentDocument.querySelector('form[method="post"]'),t={};Array.prototype.slice.call(e.querySelectorAll('input[type="hidden"]')).forEach(function(e){t[e.name]=e.value}),self.fire("authorize",{authForm:e,authData:t,authAction:e.action,authMethod:e.method})},r(s,function(){try{return/authorize_aviary/.test(n.contentDocument.location.href)}catch(e){return!1}},function(){try{return!n.contentDocument.location.origin}catch(e){return!0}},50)},activate:function(){var e,n=this;return t.prototype.activate.call(this),e={":cancel":function(e,t){e.halt(),n.confirmCancel()}},this.attachEvents(e),this},confirmAuthorize:function(t){var n=this;this.confirmAuthDialog=e.Views.dialog.getNewInstance("dialog-cta",{appContext:this.appContext,attrs:{icon:"delete"},appendTo:this.get("container").one(i.css.popups),template:"dialog-cta-reboot",content:this.templates("aviary-dialog-authorize"),stack:!0}),this.confirmAuthDialog.on("confirm",t),this.confirmAuthDialog.on("decline",function(){n.close()}),this.confirmAuthDialog.on("dismiss",function(){n.close()}),this.confirmAuthDialog.show(),this.on("destroy",function(){n.confirmAuthDialog.destroy(),n.confirmAuthlDialog=null})},confirmCancel:function(){var t=this;this.confirmCancelDialog=e.Views.dialog.getNewInstance("dialog-cta",{appContext:this.appContext,attrs:{icon:"flag"},appendTo:this.get("container").one(i.css.popups),template:"dialog-cta-reboot",content:this.templates("aviary-dialog-confirmcancel"),stack:!0}),this.confirmCancelDialog.on("confirm",function(){t.close()}),this.confirmCancelDialog.show(),this.on("destroy",function(){t.confirmCancelDialog.destroy(),t.confirmCancelDialog=null})},destroy:function(){this.close(),this._aviaryEvents&&(window.removeEventListener("message",this._aviaryEvents.handleCommand),this._aviaryEvents.handleCommand=null),this.iframe&&this.iframe.set("src","about:blank"),this.iframe=null,t.prototype.destroy.call(this)}},{ATTRS:{template:{value:"aviary"},attrs:{value:{}},photo:{value:null},hideOnCurtainClick:{value:!1}}})},"@VERSION@",{requires:["flutil","dialog","flickr-promise","hermes-templates-aviary","hermes-templates-aviary-dialog-authorize","hermes-templates-aviary-dialog-confirmcancel"],optional:["photo-models","aviary-css"]});
YUI.add("hermes-templates-confirmation-dialog",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='\n		<div class="dialog-icon ',(i=n.icon)?i=i.call(e,{hash:{},data:t}):(i=e.icon,i=typeof i===f?i.apply(e):i),r+=l(i)+'"></div>\n	',r}function d(e,t){var r="",i;return r+="\n		<h3>",(i=n.title)?i=i.call(e,{hash:{},data:t}):(i=e.title,i=typeof i===f?i.apply(e):i),r+=l(i)+"</h3>\n	",r}function v(e,t){var r="",i;return r+="<h3>",(i=n.heading)?i=i.call(e,{hash:{},data:t}):(i=e.heading,i=typeof i===f?i.apply(e):i),r+=l(i)+"</h3>",r}function m(e,t){var r="",i;return r+='\n			<button class="ui-dialog-button ui-dialog-button-confirm ',(i=n.confirmButtonClass)?i=i.call(e,{hash:{},data:t}):(i=e.confirmButtonClass,i=typeof i===f?i.apply(e):i),r+=l(i)+'"><span>',(i=n.confirmButtonLabel)?i=i.call(e,{hash:{},data:t}):(i=e.confirmButtonLabel,i=typeof i===f?i.apply(e):i),r+=l(i)+"</span></button>\n		",r}function g(e,t){var r="",i;return r+='\n			<button class="ui-dialog-button ui-dialog-button-cancel ',(i=n.cancelButtonClass)?i=i.call(e,{hash:{},data:t}):(i=e.cancelButtonClass,i=typeof i===f?i.apply(e):i),r+=l(i)+'"><span>',(i=n.cancelButtonLabel)?i=i.call(e,{hash:{},data:t}):(i=e.cancelButtonLabel,i=typeof i===f?i.apply(e):i),r+=l(i)+"</span></button>\n		",r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="dialog-title">\n	',o=n["if"].call(t,t.icon,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i),data:i});if(o||o===0)s+=o;s+='\n</div>\n\n<div class="dialog-content">\n	\n	<div class="dialog-description">\n		',o=n["if"].call(t,t.heading,{hash:{},inverse:c.noop,fn:c.program(5,v,i),data:i});if(o||o===0)s+=o;s+="\n		<p>",a={hash:{},data:i},s+=l((o=n.outlet,o?o.call(t,t.content,!1,a):h.call(t,"outlet",t.content,!1,a)))+'</p>\n	</div>\n	\n	<div class="dialog-buttons">\n		',u=n["if"].call(t,t.showConfirmButton,{hash:{},inverse:c.noop,fn:c.program(7,m,i),data:i});if(u||u===0)s+=u;s+="\n		",u=n["if"].call(t,t.showCancelButton,{hash:{},inverse:c.noop,fn:c.program(9,g,i),data:i});if(u||u===0)s+=u;return s+="\n	</div>\n	\n</div>\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/confirmation-dialog"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("confirmation-dialog-view",function(e){e.namespace("Views")[this.name]=e.Base.create("confirmation-dialog-view",e.FlickrView,[],{initializer:function(e){return this.set("title",e.title?e.title:"Confirm"),this.set("icon",e.icon?e.icon:!1),this.set("heading",e.heading?e.heading:!1),this.set("content",e.content?e.content:"A blurb about what this will do"),this.set("confirmButtonLabel",e.confirmButtonLabel?e.confirmButtonLabel:"Confirm"),this.set("cancelButtonLabel",e.cancelButtonLabel?e.cancelButtonLabel:"Cancel"),this.set("confirmButtonClass",e.confirmButtonClass?e.confirmButtonClass:""),this.set("cancelButtonClass",e.cancelButtonClass?e.cancelButtonClass:""),this.set("showConfirmButton",typeof e.showConfirmButton=="undefined"?!0:e.showConfirmButton),this.set("showCancelButton",typeof e.showCancelButton=="undefined"?!0:e.showCancelButton),this.set("dialog",e.dialog),this},render:function(){return this.setContainerHTML(this.templates("confirmation-dialog")({title:this.get("title"),icon:this.get("icon"),heading:this.get("heading"),content:this.get("content"),confirmButtonLabel:this.get("confirmButtonLabel"),cancelButtonLabel:this.get("cancelButtonLabel"),confirmButtonClass:this.get("confirmButtonClass"),cancelButtonClass:this.get("cancelButtonClass"),showConfirmButton:this.get("showConfirmButton"),showCancelButton:this.get("showCancelButton")})),this},handleCancelClick:function(t){e.Views.dialog.close()},activate:function(){var e=this;return this.get("showCancelButton")&&this.get("container").one(".ui-dialog-button-cancel").on("click",function(t){e.handleCancelClick(t)}),this}})},"@VERSION@",{requires:["flickr-view","confirmation-dialog-css","hermes-templates-confirmation-dialog"],optional:["set-models"]});
YUI.add("hermes-templates-album-selection",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n			<button class="ui-dialog-button ui-dialog-button-neutral album-selection-create-switch"><span>',(i=n.buttonTextSwitchCreate)?i=i.call(e,{hash:{},data:t}):(i=e.buttonTextSwitchCreate,i=typeof i===u?i.apply(e):i),r+=a(i)+"</span></button>\n		",r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="album-selection">\n	<h2 class="album-selection-heading">',(o=n.titleSelect)?o=o.call(t,{hash:{},data:i}):(o=t.titleSelect,o=typeof o===u?o.apply(t):o),s+=a(o)+'</h2>\n	<!-- <input type="text" placeholder="',(o=n.placeholderSearch)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderSearch,o=typeof o===u?o.apply(t):o),s+=a(o)+"\" class='album-selection-search' /> -->\n	<ol class='album-selection-list loading'>\n		<li>",(o=n.loadingText)?o=o.call(t,{hash:{},data:i}):(o=t.loadingText,o=typeof o===u?o.apply(t):o),s+=a(o)+'</li>\n	</ol>\n	<div class="album-selection-buttons">\n		',o=n["if"].call(t,t.canCreateNew,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n		<button class="ui-dialog-button ui-dialog-button-confirm album-selection-done"><span>',(o=n.buttonTextComplete)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextComplete,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span></button>\n	</div>\n</div>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/album-selection"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-album-creation",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+="<div class='album-creation'>\n	<h2 class=\"album-creation-heading\">",(o=n.titleCreate)?o=o.call(t,{hash:{},data:i}):(o=t.titleCreate,o=typeof o===u?o.apply(t):o),s+=a(o)+'</h2>\n	<input type="text" placeholder="',(o=n.placeholderTitle)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderTitle,o=typeof o===u?o.apply(t):o),s+=a(o)+"\" class='album-creation-title' />\n	<textarea placeholder=\"",(o=n.placeholderDescription)?o=o.call(t,{hash:{},data:i}):(o=t.placeholderDescription,o=typeof o===u?o.apply(t):o),s+=a(o)+'" class="album-creation-description"></textarea>\n	<div class="album-selection-buttons">\n		<button class="ui-dialog-button ui-dialog-button-confirm album-creation-create" disabled><span>',(o=n.buttonTextCreate)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextCreate,o=typeof o===u?o.apply(t):o),s+=a(o)+'</span></button>\n		<button class="ui-dialog-button ui-dialog-button-neutral album-creation-cancel"><span>',(o=n.buttonTextCancel)?o=o.call(t,{hash:{},data:i}):(o=t.buttonTextCancel,o=typeof o===u?o.apply(t):o),s+=a(o)+"</span></button>\n	</div>\n</div>",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/album-creation"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-album-selection-list-item",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var n="",r;return n+='\n		<img src="'+f((r=(r=e.primary,r==null||r===!1?r:r.sq),typeof r===a?r.apply(e):r))+'" class="album-selection-list-item-icon" />\n	',n}function h(e,t){var n="",r;return n+='\n		<img src="'+f((r=(r=e.primary,r==null||r===!1?r:r.s),typeof r===a?r.apply(e):r))+'" class="album-selection-list-item-icon" />\n	',n}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<li class="album-selection-list-item ',(o=n["class"])?o=o.call(t,{hash:{},data:i}):(o=t["class"],o=typeof o===a?o.apply(t):o),s+=f(o)+'" data-album-id="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t.id,o=typeof o===a?o.apply(t):o),s+=f(o)+'">\n	',u=n["if"].call(t,(o=t.primary,o==null||o===!1?o:o.sq),{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i),data:i});if(u||u===0)s+=u;return s+='\n	<span class="album-selection-list-item-title">',(u=n.title)?u=u.call(t,{hash:{},data:i}):(u=t.title,u=typeof u===a?u.apply(t):u),s+=f(u)+"</span>\n</li>\n",s}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each([],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/album-selection-list-item"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base"]});
YUI.add("hermes-templates-album-selection-list",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function f(e,t){var r="",i;r+="\n	",i=n.each.call(e,e.albums,{hash:{},inverse:o.noop,fn:o.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function l(e,t){var i="",s;i+="\n		",s=o.invokePartial(r["album-selection-list-item"],"album-selection-list-item",e,n,r,t);if(s||s===0)i+=s;return i+="\n	",i}function c(e,t){var r="",i;return r+="\n	<div class='none'>",(i=n.none)?i=i.call(e,{hash:{},data:t}):(i=e.none,i=typeof i===u?i.apply(e):i),r+=a(i)+"</div>\n",r}this.compilerInfo=[3,">= 1.0.0-rc.4"],n=n||e.helpers,r=r||e.partials,i=i||{};var s,o=this,u="function",a=this.escapeExpression;return s=n["if"].call(t,t.albums,{hash:{},inverse:o.program(4,c,i),fn:o.program(1,f,i),data:i}),s||s===0?s:""}),r=e.Template._cache=e.Template._cache||{},i={};e.Array.each(["album-selection-list-item"],function(e){r["hermes/"+e]&&(i[e]=r["hermes/"+e])}),r["hermes/album-selection-list"]=function(e){return n(e,{partials:i})}},"@VERSION@",{requires:["handlebars-base","hermes-templates-album-selection-list-item"]});
YUI.add("album-selection-dialog-view",function(e){e.namespace("Views")[this.name]=e.Base.create("album-selection-dialog-view",e.FlickrView,[],{initializer:function(e){return this.set("type",e.type),this.set("photoID",e.photoID),this.set("titleSelect",e.titleSelect?e.titleSelect:"Select"),this.set("titleCreate",e.titleCreate?e.titleCreate:"New"),this.set("loadingText",e.loadingText?e.loadingText:"Loading..."),this.set("noneText",e.noneText?e.noneText:"None"),this.set("placeholderSearch",e.placeholderSearch?e.placeholderSearch:"search"),this.set("placeholderTitle",e.placeholderTitle?e.placeholderTitle:"title"),this.set("placeholderDescription",e.placeholderDescription?e.placeholderDescription:"description"),this.set("buttonTextSwitchCreate",e.buttonTextSwitchCreate?e.buttonTextSwitchCreate:"Create new"),this.set("buttonTextCreate",e.buttonTextCreate?e.buttonTextCreate:"Create new"),this.set("buttonTextComplete",e.buttonTextComplete?e.buttonTextComplete:"Done"),this.set("buttonTextCancel",e.buttonTextCancel?e.buttonTextCancel:"Cancel"),this.set("canCreateNew",e.canCreateNew!=="undefined"?e.canCreateNew:!0),this},buildContainer:function(){return this.setContainerHTML(this.templates("album-selection")({titleSelect:this.get("titleSelect"),loadingText:this.get("loadingText"),placeholderSearch:this.get("placeholderSearch"),buttonTextSwitchCreate:this.get("buttonTextSwitchCreate"),buttonTextComplete:this.get("buttonTextComplete"),canCreateNew:this.get("canCreateNew")})),this.get("container").addClass("album-selection-dialog-view"),this},activate:function(){var e=this,t=this.get("container");return this.loadState().then(function(){var n=e.get("albumList"),r;n=e.addExtraTemplateData(n),t.one(".loading li").remove(),t.one(".loading").removeClass("loading"),r=e.templates("album-selection-list")({albums:n,none:e.get("noneText")}),t.one(".album-selection-list").setHTML(r)}).then(null,function(t){e.appContext.error("err",t.message,t.stack)}),t.delegate("click",function(t){e.handleDoneClick(t)},".album-selection-done"),t.delegate("click",function(t){e.handleCreateSwitchClick(t)},".album-selection-create-switch"),t.delegate("click",function(t){e.handleCancelClick(t)},".album-creation-cancel"),t.delegate("click",function(t){e.handleAdditionClick(t)},".album-selection-list-item:not(.belongs-to-album):not(.will-belong-to-album)"),t.delegate("click",function(t){e.handleRemovalClick(t)},".belongs-to-album"),t.delegate("click",function(t){e.handleNewSetClick(t)},".album-creation-create:not([disabled])"),t.delegate("valuechange",function(t){e.handleTitleChange(t)},".album-creation-title"),this},addExtraTemplateData:function(e){var t=this.get("albumListForPhoto"),n=[],r,i;for(i=0;i<t.length;i++)n.push(t[i].getValue("id"));for(r=0;r<e.length;r++)e[r].class="",e[r].class+=this.getTitleLengthClass(e[r].title)+" ",n.indexOf(e[r].id)>-1&&(e[r].class+="belongs-to-album "),e[r].compoundId&&(e[r].id=e[r].compoundId);return e},appendAlbums:function(e){var t=this.addExtraTemplateData(e),n="",r;for(r=0;r<t.length;r++)n+=this.templates("album-selection-list-item")(t[r]);this.get("container").one(".album-selection-list").append(n)},getTitleLengthClass:function(e){if(e.length>17)return"longer-title";if(e.length>14)return"long-title"},handleTitleChange:function(e){var t=this.get("container").one(".album-creation-create");e.newVal.length>0&&t.hasAttribute("disabled")?t.removeAttribute("disabled"):e.newVal.length<=0&&!t.hasAttribute("disabled")&&t.setAttribute("disabled")},handleDoneClick:function(t){e.Views.dialog.close(),e.rapidTracker.beacon(this.name,this.get("type")+"AlbumSelectionDoneClick")},handleCreateSwitchClick:function(t){var n=this.get("container");n.one(".album-selection").hide(),n.one(".album-creation")?n.one(".album-creation").show():n.append(this.templates("album-creation")({titleCreate:this.get("titleCreate"),placeholderTitle:this.get("placeholderTitle"),placeholderDescription:this.get("placeholderDescription"),buttonTextCreate:this.get("buttonTextCreate"),buttonTextCancel:this.get("buttonTextCancel")})),n.one(".album-creation-title").focus(),e.rapidTracker.beacon(this.name,this.get("type")+"AlbumSelectionSwitchModeClick")},handleCancelClick:function(t){var n=this.get("container");n.one(".album-creation").hide(),n.one(".album-selection").show(),e.rapidTracker.beacon(this.name,this.get("type")+"AlbumSelectionCancelClick")},handleAdditionClick:function(t){t.preventDefault();var n=t.currentTarget.getAttribute("data-album-id"),r=t.currentTarget,i=this;r.addClass("will-belong-to-album"),this.addPhoto(n).then(function(e){r.addClass("belongs-to-album"),r.removeClass("will-belong-to-album")}).then(null,function(e){r.removeClass("will-belong-to-album"),i.appContext.error(e.message,e.stack)}),e.rapidTracker.beacon(this.name,this.get("type")+"AlbumSelectionAdditionClick")},handleRemovalClick:function(t){t.preventDefault();var n=t.currentTarget.getAttribute("data-album-id"),r=t.currentTarget;r.removeClass("belongs-to-album"),this.removePhoto(n).then(function(e){}).then(null,function(e){r.addClass("belongs-to-album")}),e.rapidTracker.beacon(this.name,this.get("type")+"AlbumSelectionRemovalClick")},handleNewSetClick:function(t){var n=this,r=this.get("container"),i=r.one(".album-creation-title").get("value"),s=r.one(".album-creation-description").get("value"),o,u,a;r.one(".album-creation-create").setAttribute("disabled"),this.createNewAndAddPhoto(i,s).then(function(e){r.one(".album-creation").remove(),r.one(".album-selection").show(),u=n.getTitleLengthClass(e.getValue("title"))+" ",a=e.getValue("compoundId")?e.getValue("compoundId"):e.getValue("id"),o=n.templates("album-selection-list-item")({"class":u+"belongs-to-album",id:a,primary:e.getValue("primary"),title:e.getValue("title")}),r.one(".none")&&r.one(".none").remove(),r.one(".album-selection-list").prepend(o)}).then(null,function(e){r.one(".album-creation-create").removeAttribute("disabled")}),e.rapidTracker.beacon(this.name,this.get("type")+"AlbumSelectionNewAlbumClick")}}
)},"@VERSION@",{requires:["flickr-view","hermes-templates-album-selection","hermes-templates-album-creation","hermes-templates-album-selection-list","hermes-templates-album-selection-list-item"],optional:["set-models"]});
YUI.add("set-selection-dialog-view",function(e){e.namespace("Views")[this.name]=e.Base.create("set-selection-dialog-view",e.Views["album-selection-dialog-view"],[],{loadState:function(){var t=this;return this.set("page",1),this.set("perPage",500),this.appContext.getModel("sets-models",t.appContext.auth.user.nsid).then(function(e){t.set("setsModel",e)}).then(function(){return e.batch(t.get("setsModel").getValue("sets").getPage({page:t.get("page"),perPage:t.get("perPage")}),t.appContext.getModel("photo-contexts-models",t.get("photoID"))).then(function(e){var n=e[0],r=e[1],i;for(i=0;i<n.length;i++)n[i]=n[i].toJSON();t.set("albumList",n),t.set("albumListForPhoto",r.registry.getContextsOfType(t.get("photoID"),"set-models")),t.set("photoContexts",r),t.recursivelyLoadMore()},function(e){throw t.onError({message:"There was a problem loading your sets",err:e,rejuvinate:!1}),e})})},recursivelyLoadMore:function(){var e=this,t=e.get("setsModel").getValue("sets").hasMaxBoundary(),n;t||(e.set("page",e.get("page")+1),this.get("setsModel").getValue("sets").getPage({page:e.get("page"),perPage:e.get("perPage")}).then(function(t){for(n=0;n<t.length;n++)t[n]=t[n].toJSON();e.appendAlbums(t),e.recursivelyLoadMore()}).then(null,function(t){throw e.onError({message:"There was a problem loading the sets you can add photos to.",err:t,rejuvinate:!1}),t}))},addPhoto:function(e){var t=this;return this.appContext.getModelRegistry("set-models").then(function(n){return n.remote.addPhoto({photoID:t.get("photoID"),setID:e},t.appContext).then(function(e){return t.appContext.getModel("photo-contexts-models",t.get("photoID")).then(function(t){t.getValue("contexts").appendToList(e)}),e},function(e){throw t.onError({message:"There was a problem adding this photo to the set",err:e}),e})})},removePhoto:function(e){var t=this;return this.appContext.getModelRegistry("set-models").then(function(n){return n.remote.removePhoto({photoID:t.get("photoID"),setID:e},t.appContext).then(function(n){return t.appContext.getModel("photo-contexts-models",t.get("photoID")).then(function(t){t.getValue("contexts").removeFromList(e)}),n},function(e){throw t.onError({message:"There was a problem removing this photo from the set",err:e}),e})})},createNewAndAddPhoto:function(e,t){var n=this;return this.appContext.getModelRegistry("set-models").then(function(r){return r.remote.create({photoID:n.get("photoID"),title:e,description:t},n.appContext).then(function(e){return n.appContext.getModel("photo-contexts-models",n.get("photoID")).then(function(t){t.getValue("contexts").appendToList(e)}),e},function(e){throw n.onError({message:"There was a problem creating your new set",err:e}),e})})},onError:function(t){var n=this.get("container"),r,i=typeof t.rejuvinate=="undefined"?!0:t.rejuvinate,s=e.Views.dialog.getNewInstance("dialog-alert",{content:"Error! "+t.message,attrs:{level:"warning"},parent:this,visibleShim:!0});s.show(),i&&s.on("dismiss",function(t){r=e.Views.dialog.getNewInstance("dialog-modal",{content:n,appContext:this.appContext}),r.show()})}})},"@VERSION@",{requires:["flickr-view","album-selection-css","album-selection-dialog-view"],optional:["set-models"]});
