YUI.add("flickr-prefs-setSafeSearch-updater",function(e){"use strict";function t(e,t){return t.callAPI("flickr.prefs.setSafeSearch",e).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-prefs-setSafeSearch-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-prefs-setSafeSearch"]={run:t}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-people-getInfo-fetcher",function(e){"use strict";function t(e){var t={datecreate:1,extras:"icon_urls, safe_search"};if(e.id)t.user_id=e.id;else{if(!e.pathAlias)throw new Error("`fetch` is missing required params.");t.path_alias=e.pathAlias}return t}function n(t){var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5];r.exists(n.person.id)||r.add({id:n.person.id,pathAlias:n.person.pathAlias,username:n.person.username&&n.person.username._content,realname:n.person.realname&&n.person.realname._content,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(n.person.iconurls),isAdFree:n.person.isAdFree,isPro:n.person.ispro}),i.exists(n.person.id)||i.add({id:n.person.id,isContact:n.person.contact,isFriend:n.person.friend,isFamily:n.person.family,isIgnored:n.person.ignored}),s.exists(n.person.id)||s.add({id:n.person.id}),u.exists(n.person.id)||u.add({id:n.person.id,photocount:n.person.photos.count.content}),"safeSearch"in n.person&&(o.exists(n.person.id)||o.add({id:n.person.id,safeSearch:(n.person.safeSearch||1)-1}))}function r(t,n){var r=this;return e.batch(n.callAPI("flickr.people.getInfo",this._processParams(t)),n.getModelRegistry("person-models"),n.getModelRegistry("person-relationship-models"),n.getModelRegistry("person-profile-models"),n.getModelRegistry("person-preferences-models"),n.getModelRegistry("person-totals-models")).then(r._processResponse,function(e){throw n[e.fatal?"error":"debug"]("[flickr-people-getInfo-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:r,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","flickr-promise"],optional:["person-models","person-relationship-models","person-profile-models","person-preferences-models","person-totals-models","api-helper"]});
YUI.add("person-profile-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{nsid:{readOnly:!0,defaultFn:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher"]});
YUI.add("person-preferences-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[],i={};return e.Lang.isObject(n,!0)&&"safeSearch"in n&&(i.safe_search=e.AttributeHelpers.coerceInteger(n.safeSearch.newVal)+1,r.push(e.ModelUpdaters["flickr-prefs-setSafeSearch"].run(i,this.appContext))),e.batch.apply(null,r)}},attributes:{safeSearch:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","flickr-prefs-setSafeSearch-updater","attribute-helpers"]});
YUI.add("person-totals-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{photocount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return 0}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher"]});
YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return e}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},buddyicon:{},nsid:{readOnly:!0,defaultFn:function(e){return e}},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var n=this.getValue(t,"isPro"),r=this.getValue(t,"isAdFree");return n||r}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return"/photos/"+t+"/"}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers"]});
YUI.add("flickr-favorites-add-updater",function(e){"use strict";function t(e,t){var n={};return n.photo_id=e.photoId,t.callAPI("flickr.favorites.add",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-favorites-add-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-favorites-add"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-favorites-remove-updater",function(e){"use strict";function t(e,t){var n={};return n.photo_id=e.photoId,t.callAPI("flickr.favorites.remove",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-favorites-remove-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-favorites-remove"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("photo-engagement-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[],i;return e.Lang.isObject(n,!0)&&"isFaved"in n&&(i=n.isFaved.newVal?"flickr-favorites-add":"flickr-favorites-remove",r.push(e.ModelUpdaters[i].run({photoId:t},this.appContext))),e.batch.apply(null,r)}},toggleFave:function(e){var t=this.getValue(e,"faveCount"),n=this.getValue(e,"isFaved"),r=!n,i=t+(r?1:-1);this.setValues(e,{isFaved:r,faveCount:i})},addAsFave:function(e){var t=this.getValue(e,"faveCount"),n=this.getValue(e,"isFaved");return n?!1:(this.setValues(e,{isFaved:!0,faveCount:t+1}),!0)},attributes:{ownerNsid:{},isFaved:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},faveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},canShare:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canDownload:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var n=this.appContext.getViewer();return!!n.signedIn&&this.getValue(t,"ownerNsid")===n.nsid}},canFave:{readOnly:!0,derivedBy:["is_owner"],getter:function(e,t){return!this.getValue(t,"isOwner")}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","flickr-favorites-add-updater","flickr-favorites-remove-updater","attribute-helpers"]});
YUI.add("flickr-photos-getHtmlMeta-fetcher",function(e){"use strict";function t(e,t){var n=e[0],r=e[1],i;n&&n.HTMLMETA&&(i={id:n.photoId,"og:title":n.HTMLMETA["og:title"],"og:description":n.HTMLMETA["og:description"],"og:type":n.HTMLMETA["og:type"],"og:url":n.HTMLMETA["og:url"],"og:site_name":n.HTMLMETA["og:site_name"],"og:image":n.HTMLMETA["og:image"],"og:image:width":n.HTMLMETA["og:image:width"],"og:image:height":n.HTMLMETA["og:image:height"],"flickr_photos:by":n.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":n.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":n.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":n.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":n.HTMLMETA["flickr_photos:galleries"],"twitter:card":n.HTMLMETA["twitter:card"],"twitter:site":n.HTMLMETA["twitter:site"],"twitter:app:name:iphone":n.HTMLMETA["twitter:app:name:iphone"],"twitter:description":n.HTMLMETA["twitter:description"],"twitter:app:url:iphone":n.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":n.HTMLMETA["twitter:creator"]},r.exists(t.id)||r.add(i))}function n(t,n){var r=t.id,i={photo_id:r},s=this;return e.batch(n.callAPI("flickr.photos.getHtmlMeta",i),n.getModelRegistry("photo-head-meta-models")).then(function(e){return s._processResponse(e,t)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getHtmlMeta-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-photos-getHtmlMeta"]={run:n,_processResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-head-meta-models"]});
YUI.add("photo-head-meta-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getHtmlMeta"].run(t,this.appContext)}},getFieldsForDisplay:function(e){var t={},n=["og:title","og:description","og:type","og:url","og:site_name","og:image","og:image:width","og:image:height","flickr_photos:by","flickr_photos:camera","flickr_photos:sets","flickr_photos:groups","flickr_photos:galleries","twitter:card","twitter:site","twitter:app:name:iphone","twitter:description","twitter:app:url:iphone","twitter:creator","pinterest"],r=this;return n.forEach(function(n){var i=r.getValue(e,n);typeof i!="undefined"&&(t[n]=i)}),t},attributes:{"og:title":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"og:description":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"og:type":{},"og:url":{},"og:site_name":{},"og:image":{},"og:image:width":{},"og:image:height":{},"flickr_photos:by":{},"flickr_photos:camera":{},"flickr_photos:sets":{},"flickr_photos:groups":{},"flickr_photos:galleries":{},"twitter:card":{},"twitter:site":{},"twitter:app:name:iphone":{},"twitter:description":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"twitter:app:url:iphone":{},"twitter:creator":{},pinterest:{setter:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getHtmlMeta-fetcher","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("flickr-photos-getInfo-fetcher",function(e){"use strict";function t(e){var t={datecreate:1,extras:"sizes, icon_urls, count_faves, contact, ignored, needs_interstitial, safety_level, media, tags, venue",photo_id:e.id,get_contexts:1};return e.userId?t.user_id=e.userId:e.pathAlias&&(t.path_alias=e.pathAlias),t}function n(t,n){var i=t.apiResponse,s=t.photoRegistry,o=t.personRegistry,u=t.personRelationshipRegistry,a=t.photoEngagementRegistry,f=t.photoStatsRegistry,l=t.photoPrivacyRegistry,c=t.photoTagsRegistry,h=t.tagRegistry,p=t.photoLocationRegistry,d=t.photoHeadMetaRegistry,v,m={},g,y,b,w,E,S,x=[],T,N;g={id:i.photo.id,title:i.photo.title.content,description:i.photo.description.content,sizes:e.APIHelper.response.parsePhotoSize(i.photo.sizes.size,!0),needsInterstitial:i.photo.needsInterstitial,canComment:i.photo.editability.cancomment,canAddMeta:i.photo.editability.canaddmeta,safetyLevel:i.photo.safetyLevel,license:i.photo.license,mediaType:i.photo.media,secret:i.photo.secret},y={id:i.photo.owner.nsid,username:i.photo.owner.username,realname:i.photo.owner.realname,pathAlias:i.photo.owner.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(i.photo.owner.iconurls),isAdFree:i.photo.owner.isAdFree,isPro:i.photo.owner.ispro},b={id:i.photo.owner.nsid,isContact:i.photo.contactIscontact,isFamily:i.photo.contactIsfamily,isFriend:i.photo.contactIsfriend,isIgnored:i.photo.owner.isignored},w={id:i.photo.id,ownerNsid:i.photo.owner.nsid,isFaved:i.photo.isfavorite||!1,canShare:i.photo.usage.canshare,canDownload:i.photo.usage.candownload,commentCount:i.photo.comments.content,faveCount:i.photo.countFaves},E={id:i.photo.id,viewCount:i.photo.views,dateTaken:i.photo.dates.taken,takenGranularity:i.photo.dates.takengranularity},T={id:i.photo.id,"og:title":i.photo.HTMLMETA["og:title"],"og:description":i.photo.HTMLMETA["og:description"],"og:type":i.photo.HTMLMETA["og:type"],"og:url":i.photo.HTMLMETA["og:url"],"og:site_name":i.photo.HTMLMETA["og:site_name"],"og:image":i.photo.HTMLMETA["og:image"],"og:image:width":i.photo.HTMLMETA["og:image:width"],"og:image:height":i.photo.HTMLMETA["og:image:height"],"flickr_photos:by":i.photo.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":i.photo.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":i.photo.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":i.photo.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":i.photo.HTMLMETA["flickr_photos:galleries"],"twitter:card":i.photo.HTMLMETA["twitter:card"],"twitter:site":i.photo.HTMLMETA["twitter:site"],"twitter:app:name:iphone":i.photo.HTMLMETA["twitter:app:name:iphone"],"twitter:description":i.photo.HTMLMETA["twitter:description"],"twitter:app:url:iphone":i.photo.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":i.photo.HTMLMETA["twitter:creator"],pinterest:i.photo.HTMLMETA.pinterest},S={id:i.photo.id,isPublic:i.photo.visibility.ispublic,isVisibleByFriends:i.photo.visibility.isfriend,isVisibleByFamily:i.photo.visibility.isfamily,permAddMeta:i.photo.permissions?i.photo.permissions.permaddmeta:0,permComment:i.photo.permissions?i.photo.permissions.permcomment:0},i.photo&&i.photo.tags&&i.photo.tags.tag&&e.Array(i.photo.tags.tag).forEach(function(e){e.machineTag===0&&(h.exists(e.id)||h.add({id:e.id,tagRaw:e.raw,tagValue:n.isFlipped("tags-charm")?e.content:e.content.replace(/\s/g,""),tagAuthorNSID:e.author}),x.push(h.proxy(e.id)))}),N=e.ModelFetchers["flickr-photos-getLocation"].mapResponse(i),g.owner=o.exists(y.id)?o.proxy(y.id):o.add(y),u.exists(b.id)||u.add(b),a.exists(w.id)||a.add(w),s.exists(g.id)||s.add(g),f.exists(g.id)||f.add(E),l.exists(g.id)||l.add(S),c.exists(g.id)||c.add({id:g.id,tags:x}),d.exists(g.id)||d.add(T),p.exists(g.id)||p.add(N),i.photo.contexts&&(v=t.contextsRegistry,m.faves=t.favoriteRegistry,m.gallery=t.galleryRegistry,m.pool=t.groupsPoolRegistry,m.set=t.setRegistry,m.stream=t.photostreamRegistry,r(g.id,m,i.photo.contexts,o,v))}function r(t,n,r,i,s){var o=[];e.Object.each(n,function(t,n){r[n]&&e.Array.each(r[n],function(e){t.name==="gallery-models"&&(e.compoundId=e.id,e.id=e.id.split("-")[1]),t.exists(e.id)||(e.owner&&(i.exists(e.owner.nsid)||i.add(e.owner),e.owner=i.proxy(e.owner.nsid)),t.add(e)),o.push(t.proxy(e.id))})}),s.exists(t)||(s.add({id:t}),s.setValue(t,"contexts",o))}function i(t,n){var r=this;return(new e.FlickrPromise({apiResponse:n.callAPI("flickr.photos.getInfo",this._processParams(t)),photoRegistry:n.getModelRegistry("photo-models"),personRegistry:n.getModelRegistry("person-models"),personRelationshipRegistry:n.getModelRegistry("person-relationship-models"),photoEngagementRegistry:n.getModelRegistry("photo-engagement-models"),photoStatsRegistry:n.getModelRegistry("photo-stats-models"),photoPrivacyRegistry:n.getModelRegistry("photo-privacy-models"),photoTagsRegistry:n.getModelRegistry("photo-tags-models"),tagRegistry:n.getModelRegistry("tag-models"),photoLocationRegistry:n.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:n.getModelRegistry("photo-head-meta-models"),contextsRegistry:n.getModelRegistry("photo-contexts-models"),favoriteRegistry:n.getModelRegistry("favorite-models"),galleryRegistry:n.getModelRegistry("gallery-models"),groupsPoolRegistry:n.getModelRegistry("groups-pool-models"),setRegistry:n.getModelRegistry("set-models"),photostreamRegistry:n.getModelRegistry("photostream-models")})).then(function(e){return r._processResponse(e,n.flipper)},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getInfo-fetcher] failed getting or processing API response:",e),e})}e.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:i,_processParams:t,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-head-meta-models"]});
YUI.add("photo-stats-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},attributes:{viewCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},dateTaken:{},takenGranularity:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){t=e.AttributeHelpers.coerceInteger(t);if(t<0||t>10)t=undefined;return t},defaultValue:0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("photo-location-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext).then(function(e){return e},function(){})}},attributes:{hasGeo:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},latitude:{},longitude:{},levels:{},text:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("flickr-photos-getLocation-fetcher",function(e){"use strict";function t(e){var t=e.photo||{},r=t.location||null,i=t.venues?t.venues.venue:null,s;return s={id:t.id,levels:{}},r?(s.hasGeo=!0,s.latitude=r.latitude,s.longitude=r.longitude,["neighbourhood","locality","region","county","country"].forEach(function(e){if(!r[e])return;s.levels[e]={name:r[e].content||null,woeId:r[e].woeid||null}})):s.hasGeo=!1,i&&(s.levels.venue={name:i.content||i.address||null,woeId:i.woe_id}),s.text=n(s.levels),s}function n(e){var t=[],n,r,i;n=[["venue","locality","region"],["neighbourhood","locality","region"],["locality","region","country"],["county","region","country"]];while(n.length&&t.length<3){r=n.shift(),t=[];while(r.length&&t.length<3)i=r.shift(),e[i]&&e[i].name&&t.push(e[i].name)}return t.join(", ")}function r(t,n){var r=t.id,i={photo_id:r,extras:"venue"},s=this;return e.batch(n.callAPI("flickr.photos.geo.getLocation",i),n.getModelRegistry("photo-location-models")).then(function(e){var t=e[1];return t.add(s.mapResponse(e[0]))},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-getLocation-fetcher] failed getting or processing API response: ",e),e})}e.namespace("ModelFetchers")["flickr-photos-getLocation"]={run:r,mapResponse:t}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-location-models"]});
YUI.add("flickr-photos-setPerms-updater",function(e){"use strict";function t(e,t){return t.callAPI("flickr.photos.setPerms",e).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-photos-setPerms-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:t}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setMeta-updater",function(e){"use strict";function t(t,n){var r={};return r.photo_id=t.photoId,r.title=t.title,r.description=t.description,e.batch(n.callAPI("flickr.photos.setMeta",r),n.getModelRegistry("photo-models")).then(function(e){var r=e[0],i=e[1];if(!i.exists(t.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");!r.photo||!r.photo.title||!r.photo.description?n.warn("[flickr-photos-setMeta-updater] - No updated data returned from API."):i.setValues(t.photoId,{title:r.photo.title.content,description:r.photo.description.content})},function(e){throw n[e.fatal?"error":"debug"]("[flickr-photos-setMeta-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-photos-licenses-setLicense-updater",function(e){"use strict";function t(e,t){var n={};return n.photo_id=e.photoId,n.license_id=e.license,t.callAPI("flickr.photos.licenses.setLicense",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-photos-licenses-setLicense-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:t}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setSafetyLevel-updater",function(e){"use strict";function t(e,t){var n={};return n.photo_id=e.photoId,n.safety_level=e.safetyLevel+1,t.callAPI("flickr.photos.setSafetyLevel",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-photos-setSafetyLevel-updater] failed getting or processing API response:",e),e})}e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:t}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[];return("title"in n||"description"in n)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title?n.title.newVal:this.getValue(t,"title"),description:n.description?n.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license.newVal},this.appContext)),"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:n.safetyLevel.newVal},this.appContext)),e.batch.apply(null,r)}},attributes:{owner:{isModel:!0},title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},mediaType:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"photo"},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){var n=this.getValue(t,"mediaType");return n==="video"}},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var n=this.getValue(t,"owner"),r=this.appContext.getViewer();return!!r.signedIn&&n.getValue("id")===r.nsid}},sizes:{},secret:{},needsInterstitial:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},license:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/"+e:undefined}}},getLargestSize:function(e){return this.getSizeToFit(e,{width:Number.MAX_VALUE,height:Number.MAX_VALUE})},getSizeToFit:function(t,n,r){r=r||{};var i=this,s,o=n.width,u=n.height,a=!!r.cropToFit,f=this.getValue(t,"sizes"),l=r.excludeSizes||["o"],c=r.includeSizes||Object.keys(f),h,p,d;return this._getSizeToFitMemo=this._getSizeToFitMemo||{},s=[t,o,u,a,l.sort().join(""),c.sort().join("")].join("_"),this._getSizeToFitMemo[s]||(e.Object.each(f,function(e,n){var r,i,s,f,v,m;if(e&&l.indexOf(n)===-1&&c.indexOf(n)>-1)if(!this.isSizeSquare(n)||this.isPhotoSquare(t)){r=parseInt(e.width,10),i=parseInt(e.height,10),a&&r>=o&&i>=u?s=!0:!a&&(r>=o||i>=u)&&(s=!0),s&&(h?(f=parseInt(h.height,10),i<f&&(h=e)):h=e);if(p){v=parseInt(p.width,10),m=parseInt(p.height,10);if(r>v||i>m)p=e}else p=e}d=h||p},this),this._getSizeToFitMemo[s]=d,this._getSizeToFitMemoTimer||(this._getSizeToFitMemoTimer=setTimeout(function(){delete i._getSizeToFitMemo,delete i._getSizeToFitMemoTimer},1e4))),this._getSizeToFitMemo[s]},isSizeSquare:function(e){var t={sq:"sq",q:"q"};return!!t[e]},isPhotoSquare:function(t){var n;return this._isPhotoSquareMemo=this._isPhotoSquareMemo||{},typeof this._isPhotoSquareMemo[t]!="undefined"?n=this._isPhotoSquareMemo[t]:(n=!0,e.Object.some(this.getValue(t,"sizes"),function(e,t){var r;if(e&&e.width&&e.height&&!this.isSizeSquare(t)){r=parseInt(e.width,10)/parseInt(e.height,10);if(r!==1)return n=!1,!0}},this),this._isPhotoSquareMemo[t]=n),n}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});
YUI.add("tag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-addTags"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-removeTag"].run(t,this.appContext)}},attributes:{tagValue:{setter:function(e){return e.trim().replace(/\s/g,"")}},tagRaw:{},tagAuthorNSID:{},url:{derivedBy:["tagValue"],readOnly:!0,defaultFn:function(e){var t=this.getValue(e,"tagValue");return t?"/photos/tags/"+t:undefined}}}})},"@VERSION@",{requires:["flickr-model-registry"]});
YUI.add("flickr-photos-removeTag-deletor",function(e){"use strict";function t(e,t){var n={};return n.tag_id=e,t.callAPI("flickr.photos.removeTag",n).then(null,function(e){throw t[e.fatal?"error":"debug"]("[flickr-photos-removeTag-deletor] failed getting or processing API response:",e),e})}e.namespace("ModelDeletors")["flickr-photos-removeTag"]={run:t}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("photo-tags-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-tags-getListPhoto"].run(t,this.appContext)},create:function(t){return e.ModelCreators["flickr-photos-addTags"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-removeTag"].run(t,this.appContext)}},attributes:{tags:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-tags-getListPhoto-fetcher","flickr-photos-addTags-creator","flickr-photos-removeTag-deletor"]});
